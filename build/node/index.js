!function(e,r){if("object"==typeof exports&&"object"==typeof module)module.exports=r();else if("function"==typeof define&&define.amd)define([],r);else{var t=r();for(var n in t)("object"==typeof exports?exports:e)[n]=t[n]}}(global,(function(){return function(e){var r={};function t(n){if(r[n])return r[n].exports;var a=r[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,t),a.l=!0,a.exports}return t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:n})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,r){if(1&r&&(e=t(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(t.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var a in e)t.d(n,a,function(r){return e[r]}.bind(null,a));return n},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},t.p="",t(t.s=24)}([function(e,r){e.exports=require("@babel/runtime/helpers/defineProperty")},function(e,r){e.exports=require("@babel/runtime/regenerator")},function(e,r){e.exports=require("@babel/runtime/helpers/assertThisInitialized")},function(e,r){e.exports=require("typedarray-to-buffer")},function(e,r){e.exports=require("@babel/runtime/helpers/asyncToGenerator")},function(e,r){e.exports=require("libsodium-wrappers")},function(e,r){e.exports=require("@babel/runtime/helpers/classCallCheck")},function(e,r){e.exports=require("bignumber.js")},function(e,r){e.exports=require("@babel/runtime/helpers/createClass")},function(e,r){e.exports=require("bs58check")},function(e,r){e.exports=require("pbkdf2")},function(e,r){e.exports=require("elliptic")},function(e,r){e.exports=require("@kzen-networks/thresh-sig")},function(e,r){e.exports=require("@babel/runtime/helpers/toConsumableArray")},function(e,r){e.exports=require("buffer/")},function(e,r){e.exports=require("@ledgerhq/hw-transport-node-hid")},function(e,r){e.exports=require("@babel/runtime/helpers/getPrototypeOf")},function(e,r){e.exports=require("bip39")},function(e,r){e.exports=require("@babel/runtime/helpers/slicedToArray")},function(e,r){e.exports=require("@babel/runtime/helpers/possibleConstructorReturn")},function(e,r){e.exports=require("@babel/runtime/helpers/get")},function(e,r){e.exports=require("@babel/runtime/helpers/inherits")},function(e,r){e.exports=require("xhr2")},function(e,r){e.exports=require("blake2b")},function(e,r,t){"use strict";t.r(r);var n,a=t(18),i=t.n(a),o=t(13),c=t.n(o),s=t(1),u=t.n(s),p=t(4),f=t.n(p),l=t(6),d=t.n(l),h=t(8),g=t.n(h),y=t(19),b=t.n(y),v=t(2),k=t.n(v),m=t(16),_=t.n(m),x=t(20),w=t.n(x),A=t(21),E=t.n(A),S=t(0),O=t.n(S),P=t(22),K=t.n(P),T=function(){function e(r,t){d()(this,e),O()(this,"_provider",void 0),O()(this,"_chain",void 0),this._provider=r,this._chain=t}return g()(e,[{key:"setProvider",value:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.chain;this._provider=e,this._chain=r}},{key:"provider",get:function(){return this._provider},set:function(e){this._provider=e}},{key:"chain",get:function(){return this._chain},set:function(e){this._chain=e}}]),e}(),U=t(5),C=t(10),B=t(11),F=t(3),I=t.n(F),L=t(9),N=t.n(L),q=t(7),j=t(14),M=function(e){if("number"==typeof e)return e/1e6;if("string"==typeof e)return parseInt(e,10)/1e6;throw new TypeError('Invalid parameter for "mutez" provided.')},D=function(e){return new q.BigNumber(new q.BigNumber(e).toFixed(6)).multipliedBy(1e6).toString()},z=function e(r){"("===(r=r.replace(/(?:@[a-z_]+)|(?:#.*$)/gm,"").replace(/\s+/g," ").trim()).charAt(0)&&(r=r.slice(1,-1));for(var t=0,n=!1,a=!1,i={prim:"",args:[]},o="",c=0;c<r.length;c++)if(a)o+=r[c],a=!1;else if(c===r.length-1&&!1===n||" "===r[c]&&0===t&&!1===n){if(c===r.length-1&&(o+=r[c]),o){if(o===parseInt(o,10).toString()){if(!i.prim)return{int:o};i.args.push({int:o})}else if("0"===o[0]&&"x"===o[1]){if(o=o.substr(2),!i.prim)return{bytes:o};i.args.push({bytes:o})}else i.prim?i.args.push(e(o)):i.prim=o;o=""}}else if('"'===r[c]&&n){if(n=!1,!i.prim)return{string:o};i.args.push({string:o}),o=""}else'"'!==r[c]||n||0!==t?("\\"===r[c]?a=!0:"("===r[c]?t++:")"===r[c]&&t--,o+=r[c]):n=!0;return i},H=function e(r){var t=[];if(Object.prototype.hasOwnProperty.call(r,"prim"))"Pair"===r.prim?(t.push(e(r.args[0])),t=t.concat(e(r.args[1]))):"Elt"===r.prim?t={key:e(r.args[0]),val:e(r.args[1])}:"True"===r.prim?t=!0:"False"===r.prim&&(t=!1);else if(Array.isArray(r))for(var n=r.length,a=0;a<n;a++){var i=e(r[a]);void 0!==i.key?(Array.isArray(t)&&(t={keys:[],vals:[]}),t.keys.push(i.key),t.vals.push(i.val)):t.push(i)}else t=Object.prototype.hasOwnProperty.call(r,"string")?r.string:Object.prototype.hasOwnProperty.call(r,"int")?parseInt(r.int,10):r;return t},R=function e(r){for(var t=[],n=!1,a="",i="",o=0,c=0,s=!1,u=!1,p=0;p<r.length;p++){if("}"!==i&&";"!==i||(i=""),n){if("}"===r[p]?c--:"{"===r[p]&&c++,0===c){var f=e(i);t.push({prim:a.trim(),args:[f]}),i="",c=0,n=!1}}else{if("{"===r[p]){c++,a=i,i="",n=!0;continue}if(u){i+=r[p],u=!1;continue}if(p===r.length-1&&!1===s||";"===r[p]&&0===o&&!1===s){if(p===r.length-1&&(i+=r[p]),""===i.trim()||"}"===i.trim()||";"===i.trim()){i="";continue}t.push(z(i)),i="";continue}'"'===r[p]&&s?s=!1:'"'!==r[p]||s?"\\"===r[p]?u=!0:"("===r[p]?o++:")"===r[p]&&o--:s=!0}i+=r[p]}return t},G={textEncode:function(e){return new Uint8Array(j.Buffer.from(e,"utf8"))},textDecode:function(e){return j.Buffer.from(e).toString("utf8")},b582int:function(e){for(var r=new q.BigNumber(0),t="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz",n=0;n<e.length;n++)r=r.plus(new q.BigNumber(t.indexOf(e[e.length-1-n])).multipliedBy(new q.BigNumber(t.length).exponentiatedBy(n)));return r.toString(16)},totez:M,mutez:D,b58cencode:function(e,r){var t=new Uint8Array(r.length+e.length);return t.set(r),t.set(e,r.length),N.a.encode(j.Buffer.from(t,"hex"))},b58cdecode:function(e,r){return N.a.decode(e).slice(r.length)},buf2hex:function(e){var r=new Uint8Array(e),t=[];return r.forEach((function(e){var r=e.toString(16),n="00".concat(r).slice(-2);t.push(n)})),t.join("")},hex2buf:function(e){return new Uint8Array(e.match(/[\da-f]{2}/gi).map((function(e){return parseInt(e,16)})))},hexNonce:function(e){for(var r="";e--;)r+="0123456789abcedf"[16*Math.random()|0];return r},mergebuf:function(e,r){var t=new Uint8Array(e.length+r.length);return t.set(e),t.set(r,e.length),t},sexp2mic:z,mic2arr:H,ml2mic:R,ml2tzjson:z,tzjson2arr:H,mlraw2json:R,mintotz:M,tztomin:D},Q={tz1:new Uint8Array([6,161,159]),tz2:new Uint8Array([6,161,161]),tz3:new Uint8Array([6,161,164]),KT:new Uint8Array([2,90,121]),edpk:new Uint8Array([13,15,37,217]),edsk2:new Uint8Array([13,15,58,7]),spsk:new Uint8Array([17,162,224,201]),p2sk:new Uint8Array([16,81,238,189]),sppk:new Uint8Array([3,254,226,86]),p2pk:new Uint8Array([3,178,139,127]),edesk:new Uint8Array([7,90,60,179,41]),edsk:new Uint8Array([43,246,78,7]),edsig:new Uint8Array([9,245,205,134,18]),spsig:new Uint8Array([13,115,101,19,63]),p2sig:new Uint8Array([54,240,44,52]),sig:new Uint8Array([4,130,43]),Net:new Uint8Array([87,82,0]),nce:new Uint8Array([69,220,169]),b:new Uint8Array([1,52]),o:new Uint8Array([5,116]),Lo:new Uint8Array([133,233]),LLo:new Uint8Array([29,159,109]),P:new Uint8Array([2,170]),Co:new Uint8Array([79,179]),id:new Uint8Array([153,103]),TZ:new Uint8Array([2,90,121])},Y={block:new Uint8Array([1]),endorsement:new Uint8Array([2]),generic:new Uint8Array([3])},V={"00":"parameter","01":"storage","02":"code","03":"False","04":"Elt","05":"Left","06":"None","07":"Pair","08":"Right","09":"Some","0A":"True","0B":"Unit","0C":"PACK","0D":"UNPACK","0E":"BLAKE2B","0F":"SHA256",10:"SHA512",11:"ABS",12:"ADD",13:"AMOUNT",14:"AND",15:"BALANCE",16:"CAR",17:"CDR",18:"CHECK_SIGNATURE",19:"COMPARE","1A":"CONCAT","1B":"CONS","1C":"CREATE_ACCOUNT","1D":"CREATE_CONTRACT","1E":"IMPLICIT_ACCOUNT","1F":"DIP",20:"DROP",21:"DUP",22:"EDIV",23:"EMPTY_MAP",24:"EMPTY_SET",25:"EQ",26:"EXEC",27:"FAILWITH",28:"GE",29:"GET","2A":"GT","2B":"HASH_KEY","2C":"IF","2D":"IF_CONS","2E":"IF_LEFT","2F":"IF_NONE",30:"INT",31:"LAMBDA",32:"LE",33:"LEFT",34:"LOOP",35:"LSL",36:"LSR",37:"LT",38:"MAP",39:"MEM","3A":"MUL","3B":"NEG","3C":"NEQ","3D":"NIL","3E":"NONE","3F":"NOT",40:"NOW",41:"OR",42:"PAIR",43:"PUSH",44:"RIGHT",45:"SIZE",46:"SOME",47:"SOURCE",48:"SENDER",49:"SELF","4A":"STEPS_TO_QUOTA","4B":"SUB","4C":"SWAP","4D":"TRANSFER_TOKENS","4E":"SET_DELEGATE","4F":"UNIT",50:"UPDATE",51:"XOR",52:"ITER",53:"LOOP_LEFT",54:"ADDRESS",55:"CONTRACT",56:"ISNAT",57:"CAST",58:"RENAME",59:"bool","5A":"contract","5B":"int","5C":"key","5D":"key_hash","5E":"lambda","5F":"list",60:"map",61:"big_map",62:"nat",63:"option",64:"or",65:"pair",66:"set",67:"signature",68:"string",69:"bytes","6A":"mutez","6B":"timestamp","6C":"unit","6D":"operation","6E":"address","6F":"SLICE",70:"DIG",71:"DUG",72:"EMPTY_BIG_MAP",73:"APPLY",74:"chain_id",75:"CHAIN_ID"},X=(n={},Object.keys(V).forEach((function(e){n[V[e]]=e})),n),J={"00":"default","01":"root","02":"do","03":"set_delegate","04":"remove_delegate"},W=function(){var e={};return Object.keys(J).forEach((function(r){e[J[r]]=r})),e}(),Z={opMapping:V,opMappingReverse:X,primMapping:{"00":"int","01":"string","02":"seq","03":{name:"prim",len:0,annots:!1},"04":{name:"prim",len:0,annots:!0},"05":{name:"prim",len:1,annots:!1},"06":{name:"prim",len:1,annots:!0},"07":{name:"prim",len:2,annots:!1},"08":{name:"prim",len:2,annots:!0},"09":{name:"prim",len:3,annots:!0},"0A":"bytes"},primMappingReverse:{0:{false:"03",true:"04"},1:{false:"05",true:"06"},2:{false:"07",true:"08"},3:{true:"09"}},forgeOpTags:{"004":{endorsement:0,seed_nonce_revelation:1,double_endorsement_evidence:2,double_baking_evidence:3,activate_account:4,proposals:5,ballot:6,reveal:7,transaction:8,origination:9,delegation:10},"005":{endorsement:0,seed_nonce_revelation:1,double_endorsement_evidence:2,double_baking_evidence:3,activate_account:4,proposals:5,ballot:6,reveal:107,transaction:108,origination:109,delegation:110}},entrypointMapping:J,entrypointMappingReverse:W},$={"004":"Pt24m4xiPbLDhVgVfABUjirbmda3yohdN82Sp9FeuAXJ4eV9otd","005":"PsBABY5HQTSkA4297zNHfsZNKtxULfL18y95qb3m53QJiXGmrbU"},ee={prefix:Q,watermark:Y,forgeMappings:Z,protocols:$},re=function(){function e(r,t,n){var a=this;d()(this,e),O()(this,"_curve",void 0),O()(this,"_publicKey",void 0),O()(this,"_secretKey",void 0),O()(this,"_isSecret",void 0),O()(this,"_isLedger",void 0),O()(this,"_ledgerPath",void 0),O()(this,"_ledgerCurve",void 0),O()(this,"ready",void 0),O()(this,"publicKey",(function(){return G.b58cencode(a._publicKey,Q["".concat(a._curve,"pk")])})),O()(this,"secretKey",(function(){if(!a._secretKey)throw new Error("Secret key not known.");var e=a._secretKey;if("ed"===a._curve){var r=U.crypto_sign_seed_keypair(e.slice(0,32)).privateKey;e=I()(r)}return G.b58cencode(e,Q["".concat(a._curve,"sk")])})),O()(this,"publicKeyHash",(function(){var e={ed:Q.tz1,sp:Q.tz2,p2:Q.tz3}[a._curve];return G.b58cencode(U.crypto_generichash(20,a._publicKey),e)})),O()(this,"initialize",function(){var e=f()(u.a.mark((function e(r,t,n,i){var o,c,s,p,f,l,d,h,g,y,b,v,k,m,_,x,w,A;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,U.ready;case 2:if(!n){e.next=14;break}if(t){e.next=5;break}throw new Error("Fundraiser key provided without a passphrase.");case 5:return o=G.textDecode(G.textEncode("".concat(n).concat(t))).normalize("NFKD"),c=C.pbkdf2Sync(r,"mnemonic".concat(o),2048,64,"sha512"),s=U.crypto_sign_seed_keypair(c.slice(0,32)),p=s.publicKey,f=s.privateKey,a._publicKey=I()(p),a._secretKey=I()(f),a._curve="ed",a._isSecret=!0,i(),e.abrupt("return");case 14:if(a._curve=r.substr(0,2),["sp","p2","ed"].includes(a._curve)){e.next=17;break}throw new Error("Invalid prefix for a key encoding.");case 17:if([54,55,88,98].includes(r.length)){e.next=19;break}throw new Error("Invalid length for a key encoding");case 19:if(l="e"===r.substring(2,3),d=l?r.slice(3,5):r.slice(2,4),["pk","sk"].includes(d)){e.next=23;break}throw new Error("Invalid prefix for a key encoding.");case 23:if(a._isSecret="sk"===d,h=a._isSecret?G.b58cdecode(r,Q["".concat(a._curve).concat(l?"e":"","sk")]):G.b58cdecode(r,Q["".concat(a._curve,"pk")]),!l){e.next=32;break}if(t){e.next=28;break}throw new Error("Encrypted key provided without a passphrase.");case 28:g=I()(h.slice(0,8)),y=h.slice(8),b=C.pbkdf2Sync(t,g,32768,32,"sha512"),h=U.crypto_secretbox_open_easy(y,new Uint8Array(24),b);case 32:if(a._isSecret){e.next=37;break}a._publicKey=I()(h),a._secretKey=void 0,e.next=55;break;case 37:if(a._secretKey=I()(h),"ed"!==a._curve){e.next=42;break}64===h.length?a._publicKey=I()(h.slice(32)):(v=U.crypto_sign_seed_keypair(h,"uint8array"),k=v.publicKey,m=v.privateKey,a._publicKey=I()(k),a._secretKey=I()(m)),e.next=55;break;case 42:if("sp"!==a._curve){e.next=48;break}_=new B.ec("secp256k1").keyFromPrivate(h),x=_.getPublic().getY().toArray()[31]%2?3:2,a._publicKey=I()(new Uint8Array([x].concat(_.getPublic().getX().toArray()))),e.next=55;break;case 48:if("p2"!==a._curve){e.next=54;break}w=new B.ec("p256").keyFromPrivate(h),A=w.getPublic().getY().toArray()[31]%2?3:2,a._publicKey=I()(new Uint8Array([A].concat(w.getPublic().getX().toArray()))),e.next=55;break;case 54:throw new Error("Invalid key");case 55:i();case 56:case"end":return e.stop()}}),e)})));return function(r,t,n,a){return e.apply(this,arguments)}}()),O()(this,"sign",function(){var e=f()(u.a.mark((function e(r,t){var n,i,o,c,s,p,f,l,d,h,g,y,b,v,k;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=G.hex2buf(r),void 0!==t&&(n=G.mergebuf(t,n)),i=I()(U.crypto_generichash(32,n)),a._secretKey){e.next=5;break}throw new Error("Cannot sign operations without a secret key.");case 5:if("ed"!==a._curve){e.next=12;break}return o=U.crypto_sign_detached(i,a._secretKey),c=I()(o),s=r+G.buf2hex(c),e.abrupt("return",{bytes:r,sig:G.b58cencode(o,Q.sig),prefixSig:G.b58cencode(o,Q.edsig),sbytes:s});case 12:if("sp"!==a._curve){e.next=21;break}return p=new B.ec("secp256k1").keyFromPrivate(a._secretKey),f=p.sign(i,{canonical:!0}),l=new Uint8Array(f.r.toArray().concat(f.s.toArray())),d=I()(l),h=r+G.buf2hex(d),e.abrupt("return",{bytes:r,sig:G.b58cencode(l,Q.sig),prefixSig:G.b58cencode(l,Q.spsig),sbytes:h});case 21:if("p2"!==a._curve){e.next=28;break}return g=new B.ec("p256").keyFromPrivate(a._secretKey),y=g.sign(i,{canonical:!0}),b=new Uint8Array(y.r.toArray().concat(y.s.toArray())),v=I()(b),k=r+G.buf2hex(v),e.abrupt("return",{bytes:r,sig:G.b58cencode(b,Q.sig),prefixSig:G.b58cencode(b,Q.p2sig),sbytes:k});case 28:throw new Error("Provided curve not supported");case 29:case"end":return e.stop()}}),e)})));return function(r,t){return e.apply(this,arguments)}}()),this._isLedger=!1,this._ledgerPath="44'/1729'/0'/0'",this._ledgerCurve=0,this.ready=new Promise((function(e){a.initialize(r,t,n,e)}))}return g()(e,[{key:"curve",get:function(){return this._curve}},{key:"isLedger",get:function(){return this._isLedger},set:function(e){this._isLedger=e}},{key:"ledgerPath",get:function(){return this._ledgerPath},set:function(e){this._ledgerPath=e}},{key:"ledgerCurve",get:function(){return this._ledgerCurve},set:function(e){this._ledgerCurve=e}}]),e}(),te=function(e){return e=parseInt(e,10),new Uint8Array([(4278190080&e)>>24,(16711680&e)>>16,(65280&e)>>8,255&e]).buffer},ne=function(e){var r=I()(te(e));return G.buf2hex(r)},ae=function(e){return e?"ff":"00"},ie=function(e){var r=we(e.code).toLowerCase(),t=we(e.storage).toLowerCase();return ne(r.length/2)+r+ne(t.length/2)+t},oe=function(e,r){if(r===$["005"]){var t="",n="default"===e.entrypoint;if(t+=n?"00":"FF",!n){var a=we(e.value).toLowerCase();if(Z.entrypointMappingReverse[e.entrypoint])t+=Z.entrypointMappingReverse[e.entrypoint];else t+="FF",t+=we({string:e.entrypoint}).toLowerCase().slice(8);t+=(a.length/2).toString(16).padStart(8,"0"),t+=a}return t}var i=we(e).toLowerCase();return ne(i.length/2)+i},ce=function(e){var r=parseInt(e.substr(2,1),10),t="0".concat(r-1),n=I()(G.b58cdecode(e,Q[e.substr(0,3)]));return t+=G.buf2hex(n)},se=function(e,r){var t="";if("K"===e.substr(0,1)){t+=r===$["005"]?"":"01";var n=I()(G.b58cdecode(e,Q.KT));t+=G.buf2hex(n),t+="00"}else t+=r===$["005"]?"":"00",t+=ce(e);return t},ue=function(e){var r="",t=parseInt(e,10);if(Number.isNaN(t))throw new TypeError("Error forging zarith ".concat(e));for(;;){if(t<128){t<16&&(r+="0"),r+=t.toString(16);break}var n=t%128;t-=n,t/=128,r+=(n+=128).toString(16)}return r},pe=function(e){var r="";switch(e.substr(0,2)){case"ed":r="00";break;case"sp":r="01";break;case"p2":r="02"}var t=I()(G.b58cdecode(e,Q[e.substr(0,4)]));return r+=G.buf2hex(t)},fe=function(e,r){var t,n="";return t=r===$["005"]?I()(new Uint8Array([Z.forgeOpTags["005"][e.kind]])):I()(new Uint8Array([Z.forgeOpTags["004"][e.kind]])),n=G.buf2hex(t),"endorsement"===e.kind?n+=le(e):"seed_nonce_revelation"===e.kind?n+=de(e):"double_endorsement_evidence"===e.kind?n+=he(e):"double_baking_evidence"===e.kind?n+=ge(e):"activate_account"===e.kind?n+=ye(e):"proposals"===e.kind?n+=be(e):"ballot"===e.kind?n+=ve(e):"reveal"===e.kind?n+=ke(e,r):"transaction"===e.kind?n+=me(e,r):"origination"===e.kind?n+=_e(e,r):"delegation"===e.kind&&(n+=xe(e,r)),n},le=function(e){var r=I()(te(e.level));return G.buf2hex(r)},de=function(e){var r="",t=I()(te(e.level));return r+=G.buf2hex(t),r+=e.nonce},he=function(e){throw new Error("Double endorse forging is not complete")},ge=function(e){throw new Error("Double bake forging is not complete")},ye=function(e){var r="",t=I()(G.b58cdecode(e.pkh,Q.tz1));return r+=G.buf2hex(t),r+=e.secret},be=function(e){throw new Error("Proposal forging is not complete")},ve=function(e){var r="";r+=ce(e.source);var t=I()(te(e.period));r+=G.buf2hex(t);var n,a=I()(G.b58cdecode(e.proposal,Q.P));return r+=G.buf2hex(a),n="yay"===e.ballot||"yea"===e.ballot?"00":"nay"===e.ballot?"01":"02",r+=n},ke=function(e,r){var t="";return t+=se(e.source,r),t+=ue(e.fee),t+=ue(e.counter),t+=ue(e.gas_limit),t+=ue(e.storage_limit),t+=pe(e.public_key)},me=function(e,r){var t="";return t+=se(e.source,r),t+=ue(e.fee),t+=ue(e.counter),t+=ue(e.gas_limit),t+=ue(e.storage_limit),t+=ue(e.amount),t+=se(e.destination),e.parameters?(t+=ae(!0),t+=oe(e.parameters,r)):t+=ae(!1),t},_e=function(e,r){var t="";return t+=se(e.source,r),t+=ue(e.fee),t+=ue(e.counter),t+=ue(e.gas_limit),t+=ue(e.storage_limit),r===$["005"]?(t+=ue(e.balance),e.delegate?(t+=ae(!0),t+=ce(e.delegate)):t+=ae(!1),t+=ie(e.script)):(t+=ce(e.manager_pubkey),t+=ue(e.balance),t+=ae(e.spendable),t+=ae(e.delegatable),e.delegate?(t+=ae(!0),t+=ce(e.delegate)):t+=ae(!1),e.script?(t+=ae(!0),t+=ie(e.script)):t+=ae(!1)),t},xe=function(e,r){var t="";return t+=se(e.source,r),t+=ue(e.fee),t+=ue(e.counter),t+=ue(e.gas_limit),t+=ue(e.storage_limit),e.delegate?(t+=ae(!0),t+=ce(e.delegate)):t+=ae(!1),t},we=function(e){return function e(r){var t=[];if(r instanceof Array){t.push("02");var n=r.map((function(r){return e(r)})).join(""),a=n.length/2;t.push(a.toString(16).padStart(8,"0")),t.push(n)}else if(r instanceof Object)if("prim"in r){var i=r.args?r.args.length:0;if(t.push(Z.primMappingReverse[i]["".concat(!!r.annots)]),t.push(Z.opMappingReverse[r.prim]),r.args&&r.args.forEach((function(r){return t.push(e(r))})),r.annots){var o=r.annots.map((function(e){var r=I()(G.textEncode(e));return G.buf2hex(r)})).join("20");t.push((o.length/2).toString(16).padStart(8,"0")),t.push(o)}}else if("bytes"in r){var c=r.bytes.length/2;t.push("0A"),t.push(c.toString(16).padStart(8,"0")),t.push(r.bytes)}else if("int"in r){var s=new q.BigNumber(r.int,10),u="-"===s.toString(2)[0]?"1":"0",p=s.toString(2).replace("-",""),f=p.length<=6?6:(p.length-6)%7?p.length+7-(p.length-6)%7:p.length,l=p.padStart(f,"0").match(/\d{6,7}/g).reverse();l[0]=u+l[0];var d=l.map((function(e,r){return parseInt((r===l.length-1?"0":"1")+e,2).toString(16).padStart(2,"0")})).join("");t.push("00"),t.push(d)}else if("string"in r){var h=G.textEncode(r.string),g=[].slice.call(h).map((function(e){return e.toString(16).padStart(2,"0")})).join(""),y=h.length;t.push("01"),t.push(y.toString(16).padStart(8,"0")),t.push(g)}return t.join("")}(e).toUpperCase()},Ae={address:se,decodeRawBytes:function(e){e=e.toUpperCase();var r=0,t=function(t){var n=e.slice(r,r+t);return r+=t,n};return function e(){var n=t(2),a=Z.primMapping[n];if(a instanceof Object){var i={prim:Z.opMapping[t(2)],args:c()(Array(a.len)).map((function(){return e()})),annots:void 0};if(a.len||delete i.args,a.annots){var o=2*parseInt(t(8),16),s=t(o).match(/[\dA-F]{2}/g);if(s){var u=new Uint8Array(s.map((function(e){return parseInt(e,16)}))),p=G.textDecode(u);i.annots=p.split(" ")}}else delete i.annots;return i}if("0A"===n){var f=t(8),l=2*parseInt(f,16);return{bytes:t(l)}}if("01"===n){var d=t(8),h=2*parseInt(d,16),g=t(h).match(/[\dA-F]{2}/g);if(g instanceof Array){var y=new Uint8Array(g.map((function(e){return parseInt(e,16)})));return{string:G.textDecode(y)}}throw new Error("Input bytes error")}if("00"===n){for(var b=parseInt(t(2),16).toString(2).padStart(8,"0"),v=[b.slice(2)],k="1"===b[0];k;){var m=parseInt(t(2),16).toString(2).padStart(8,"0");v.push(m.slice(1)),k="1"===m[0]}return{int:new q.BigNumber(v.reverse().join(""),2).toString()}}if("02"===n){for(var _=t(8),x=2*parseInt(_,16),w=r+x,A=[];w>r;)A.push(e());return A}throw new Error("Invalid raw bytes: Byte:".concat(n," Index:").concat(r))}()},encodeRawBytes:we,forge:function(){var e=f()(u.a.mark((function e(r,t,n){var a,i;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.contents){e.next=2;break}throw new Error("No operation contents provided.");case 2:if(r.branch){e.next=4;break}throw new Error("No operation branch provided.");case 4:return a=I()(G.b58cdecode(r.branch,Q.b)),i=G.buf2hex(a),r.contents.forEach((function(e){i+=fe(e,n)})),e.abrupt("return",{opbytes:i,opOb:r,counter:t});case 8:case"end":return e.stop()}}),e)})));return function(r,t,n){return e.apply(this,arguments)}}(),op:fe,endorsement:le,seedNonceRevelation:de,doubleEndorsementEvidence:he,doubleBakingEvidence:ge,activateAccount:ye,proposals:be,ballot:ve,reveal:ke,transaction:me,origination:_e,delegation:xe,parameters:oe,publicKey:pe,publicKeyHash:ce,zarith:ue,bool:ae,script:ie,toBytesInt32:te,toBytesInt32Hex:ne},Ee=t(23),Se=t.n(Ee);function Oe(e){var r=[];return e.split("/").forEach((function(e){var t=parseInt(e,10);Number.isNaN(t)||(e.length>1&&"'"===e[e.length-1]&&(t+=2147483648),r.push(t))})),r}function Pe(e,r){return Promise.resolve().then((function(){return function e(t,n,a){return t>=n.length?a:r(n[t],t).then((function(r){return a.push(r),e(t+1,n,a)}))}(0,e,[])}))}var Ke=function(e){switch(e){case 0:return Buffer.of(13,15,37,217);case 1:return Buffer.of(3,254,226,86);case 2:return Buffer.of(3,178,139,127);default:return Buffer.of(0)}},Te=function(e){switch(e){case 0:return Buffer.of(6,161,159);case 1:return Buffer.of(6,161,161);case 2:return Buffer.of(6,161,164);default:return Buffer.of(0)}},Ue=function(e,r){return e=function(e,r){switch(r){case 0:return(e=e.slice(0))[0]=r,e;case 1:case 2:return Buffer.concat([Buffer.of(r,2+(1&e[64])),e.slice(1,33)]);default:return Buffer.of(0)}}(e,r),{publicKey:Ce(e),address:Be(e)}},Ce=function(e){var r=e[0],t=e.slice(1);return N.a.encode(Buffer.concat([Ke(r),t]))},Be=function(e){var r=e[0],t=e.slice(1),n=Se()(20);return n.update(t),n.digest(n=Buffer.alloc(20)),N.a.encode(Buffer.concat([Te(r),n]))},Fe=function(){function e(r){d()(this,e),O()(this,"transport",void 0),this.transport=r,r.decorateAppAPIMethods(this,["getAddress","signOperation","getVersion"],"XTZ")}return g()(e,[{key:"getAddress",value:function(e,r,t){var n=Oe(e);t=t||0;var a=Buffer.alloc(1+4*n.length);return a[0]=n.length,n.forEach((function(e,r){a.writeUInt32BE(e,1+4*r)})),this.transport.send(128,r?3:2,0,t,a).then((function(e){var r=e[0],n=e.slice(1,1+r);return Ue(n,t)}))}},{key:"signOperation",value:function(e,r,t){var n,a=this,i=Oe(e),o=0,c=Buffer.from(r,"hex"),s=[];t=t||0;var u=Buffer.alloc(4*i.length+1);for(u[0]=i.length,i.forEach((function(e,r){u.writeUInt32BE(e,1+4*r)})),s.push(u);o!==c.length;){var p=void 0;p=o+255>=c.length?c.length-o:255;var f=Buffer.alloc(p);c.copy(f,0,o,o+p),s.push(f),o+=p}return Pe(s,(function(e,r){var i=1;return 0===r?i=0:r===s.length-1&&(i=129),a.transport.send(128,4,i,t,e).then((function(e){n=e}))})).then((function(){return{signature:n.slice(0,n.length-2).toString("hex")}}))}},{key:"getVersion",value:function(){return this.transport.send(128,0,0,0,Buffer.alloc(0)).then((function(e){var r=1===e[0];return{major:e[1],minor:e[2],patch:e[3],bakingApp:r}}))}}]),e}(),Ie=t(15),Le=t.n(Ie),Ne={getAddress:function(){var e=f()(u.a.mark((function e(){var r,t,n,a,i,o,c,s,p,f,l=arguments;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=l.length>0&&void 0!==l[0]?l[0]:{},t=r.path,n=void 0===t?"44'/1729'/0'/0'":t,a=r.displayConfirm,i=void 0===a||a,o=r.curve,c=void 0===o?0:o,e.next=3,Le.a.create();case 3:return s=e.sent,p=new Fe(s),e.prev=5,e.next=8,p.getAddress(n,i,c);case 8:f=e.sent,e.next=15;break;case 11:return e.prev=11,e.t0=e.catch(5),s.close(),e.abrupt("return",e.t0);case 15:return s.close(),e.abrupt("return",f);case 17:case"end":return e.stop()}}),e,null,[[5,11]])})));return function(){return e.apply(this,arguments)}}(),signOperation:function(){var e=f()(u.a.mark((function e(r){var t,n,a,i,o,c,s,p,f;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.path,n=void 0===t?"44'/1729'/0'/0'":t,a=r.rawTxHex,i=r.curve,o=void 0===i?0:i,e.next=3,Le.a.create();case 3:return c=e.sent,s=new Fe(c),e.prev=5,e.next=8,s.signOperation(n,"03".concat(a),o);case 8:f=e.sent,p=f.signature,e.next=16;break;case 12:return e.prev=12,e.t0=e.catch(5),c.close(),e.abrupt("return",e.t0);case 16:return c.close(),e.abrupt("return",p);case 18:case"end":return e.stop()}}),e,null,[[5,12]])})));return function(r){return e.apply(this,arguments)}}(),getVersion:function(){var e=f()(u.a.mark((function e(){var r,t,n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Le.a.create();case 2:return r=e.sent,t=new Fe(r),e.prev=4,e.next=7,t.getVersion();case 7:n=e.sent,e.next=14;break;case 10:return e.prev=10,e.t0=e.catch(4),r.close(),e.abrupt("return",e.t0);case 14:return r.close(),e.abrupt("return",n);case 16:case"end":return e.stop()}}),e,null,[[4,10]])})));return function(){return e.apply(this,arguments)}}()},qe=function e(r,t){var n=this;d()(this,e),O()(this,"_p2",void 0),O()(this,"_p2Share",void 0),O()(this,"ready",void 0),O()(this,"initialize",f()(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,U.ready;case 2:if(n._p2Share){e.next=6;break}return e.next=5,n._p2.generateKey();case 5:n._p2Share=e.sent;case 6:case"end":return e.stop()}}),e)})))),O()(this,"secretShare",(function(){return n._p2Share})),O()(this,"publicKey",(function(){var e=n._p2Share.getAggregatedPublicKey().apk.bytes_str;return G.b58cencode(new Uint8Array(Buffer.from(e,"hex")),Q.edpk)})),O()(this,"publicKeyHash",(function(){var e=new Uint8Array(Buffer.from(n._p2Share.getAggregatedPublicKey().apk.bytes_str,"hex"));return G.b58cencode(U.crypto_generichash(20,e),Q.tz1)})),O()(this,"sign",function(){var e=f()(u.a.mark((function e(r,t){var a,i,o,c,s;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=G.hex2buf(r),void 0!==t&&(a=G.mergebuf(t,a)),i=I()(U.crypto_generichash(32,a)),n._p2&&n._p2Share){e.next=5;break}throw new Error("Cannot sign operations without intiialized Ed25519 party2 or secret share.");case 5:return e.t0=Uint8Array,e.next=8,n._p2.sign(i,n._p2Share);case 8:return e.t1=e.sent.toBuffer(),o=new e.t0(e.t1),c=I()(o),s=r+G.buf2hex(c),e.abrupt("return",{bytes:r,sig:G.b58cencode(o,Q.sig),prefixSig:G.b58cencode(o,Q.edsig),sbytes:s});case 13:case"end":return e.stop()}}),e)})));return function(r,t){return e.apply(this,arguments)}}()),this._p2=r,this._p2Share=t,this.ready=this.initialize()};function je(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function Me(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?je(t,!0).forEach((function(r){O()(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):je(t).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}var De=function(e){function r(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"http://127.0.0.1:8732",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"main",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return d()(this,r),e=b()(this,_()(r).call(this,t,n)),O()(k()(e),"_localForge",void 0),O()(k()(e),"_validateLocalForge",void 0),O()(k()(e),"_defaultFee",void 0),O()(k()(e),"_debugMode",void 0),O()(k()(e),"_counters",void 0),O()(k()(e),"key",void 0),O()(k()(e),"party2",void 0),O()(k()(e),"importKey",function(){var r=f()(u.a.mark((function r(t,n,a){return u.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return e.key=new re(t,n,a),r.next=3,e.key.ready;case 3:case"end":return r.stop()}}),r)})));return function(e,t,n){return r.apply(this,arguments)}}()),O()(k()(e),"importEd25519Party2",function(){var r=f()(u.a.mark((function r(t,n){return u.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return e.party2=new qe(t,n),r.next=3,e.party2.ready;case 3:case"end":return r.stop()}}),r)})));return function(e,t){return r.apply(this,arguments)}}()),O()(k()(e),"importLedger",f()(u.a.mark((function r(){var t,n,a,i,o=arguments;return u.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t=o.length>0&&void 0!==o[0]?o[0]:"44'/1729'/0'/0'",0===(n=o.length>1&&void 0!==o[1]?o[1]:0)){r.next=4;break}throw new Error("Only ed25519 curve (0x00) is supported for ledger at the moment.");case 4:return r.next=6,Ne.getAddress({path:t,displayConfirm:!0,curve:n});case 6:return a=r.sent,i=a.publicKey,e.key=new re(i),r.next=11,e.key.ready;case 11:e.key&&(e.key.isLedger=!0,e.key.ledgerPath=t,e.key.ledgerCurve=n);case 12:case"end":return r.stop()}}),r)})))),O()(k()(e),"query",(function(r,t,n){return void 0===t?void 0===n?n="GET":t={}:void 0===n&&(n="POST"),new Promise((function(a,i){try{var o=new K.a;o.open(n,e.provider+r,!0),o.onload=function(){if(e._debugMode&&console.log("Node call:",r,t),200===o.status)if(o.responseText){var n=JSON.parse(o.responseText);e._debugMode&&console.log("Node response:",r,n),n&&void 0!==n.error?i(n.error):(n&&void 0!==n.ok&&(n=n.ok),a(n))}else i("Empty response returned");else o.responseText?i(o.responseText):i(o.statusText)},o.onerror=function(){i(o.statusText)},"POST"===n?(o.setRequestHeader("Content-Type","application/json"),o.send(JSON.stringify(t))):o.send()}catch(e){i(e)}}))})),O()(k()(e),"account",function(){var r=f()(u.a.mark((function r(t){var n,a,i,o,c,s,p,f,l,d,h,g;return u.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=t.balance,a=t.spendable,i=t.delegatable,o=t.delegate,c=t.fee,s=void 0===c?e.defaultFee:c,p=t.gasLimit,f=void 0===p?10600:p,l=t.storageLimit,d=void 0===l?257:l,h={},void 0!==a&&(h.spendable=a),void 0!==i&&(h.delegatable=i),o&&(h.delegate=o),g=[Me({kind:"origination",balance:G.mutez(n),fee:s,gas_limit:f,storage_limit:d,manager_pubkey:e.key&&e.key.publicKeyHash()||e.party2.publicKeyHash()},h)],r.abrupt("return",e.sendOperation({operation:g}));case 7:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}()),O()(k()(e),"getBalance",(function(r){return e.query("/chains/".concat(e.chain,"/blocks/head/context/contracts/").concat(r,"/balance"))})),O()(k()(e),"getDelegate",(function(r){return e.query("/chains/".concat(e.chain,"/blocks/head/context/contracts/").concat(r,"/delegate")).then((function(e){return e||!1}))})),O()(k()(e),"getManager",(function(r){return e.query("/chains/".concat(e.chain,"/blocks/head/context/contracts/").concat(r,"/manager_key"))})),O()(k()(e),"getCounter",(function(r){return e.query("/chains/".concat(e.chain,"/blocks/head/context/contracts/").concat(r,"/counter"))})),O()(k()(e),"getBaker",(function(r){return e.query("/chains/".concat(e.chain,"/blocks/head/context/delegates/").concat(r))})),O()(k()(e),"getHeader",(function(){return e.query("/chains/".concat(e.chain,"/blocks/head/header"))})),O()(k()(e),"getHeadMetadata",(function(){return e.query("/chains/".concat(e.chain,"/blocks/head/metadata"))})),O()(k()(e),"getHead",(function(){return e.query("/chains/".concat(e.chain,"/blocks/head"))})),O()(k()(e),"getHeadHash",(function(){return e.query("/chains/".concat(e.chain,"/blocks/head/hash"))})),O()(k()(e),"getBallotList",(function(){return e.query("/chains/".concat(e.chain,"/blocks/head/votes/ballot_list"))})),O()(k()(e),"getProposals",(function(){return e.query("/chains/".concat(e.chain,"/blocks/head/votes/proposals"))})),O()(k()(e),"getBallots",(function(){return e.query("/chains/".concat(e.chain,"/blocks/head/votes/ballots"))})),O()(k()(e),"getListings",(function(){return e.query("/chains/".concat(e.chain,"/blocks/head/votes/listings"))})),O()(k()(e),"getCurrentProposal",(function(){return e.query("/chains/".concat(e.chain,"/blocks/head/votes/current_proposal"))})),O()(k()(e),"getCurrentPeriod",(function(){return e.query("/chains/".concat(e.chain,"/blocks/head/votes/current_period_kind"))})),O()(k()(e),"getCurrentQuorum",(function(){return e.query("/chains/".concat(e.chain,"/blocks/head/votes/current_quorum"))})),O()(k()(e),"awaitOperation",(function(r){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:180;if(n<=0)throw new Error("Timeout must be more than 0");if(t<=0)throw new Error("Interval must be more than 0");var a=Math.ceil(n/t)+1,i=0,o=!1,c=function(e){e.hash===r&&(o=!0)};return new Promise((function(r,n){!function s(){return e.getHead().then((function(e){i++;for(var u=3;u>=0;u--)e.operations[u].forEach(c);o?r(e.hash):i>=a?n(new Error("Timeout")):setTimeout(s,1e3*t)}))}()}))})),O()(k()(e),"call",(function(r,t){return e.query(r,t)})),O()(k()(e),"prepareOperation",(function(r){var t,n,a=r.operation,o=r.source,s={},p=[],l=!1,d=[];p.push(e.getHeader()),p.push(e.getHeadMetadata()),d=Array.isArray(a)?c()(a):[a];for(var h=e.key&&e.key.publicKey()||e.party2.publicKey(),g=o||e.key&&e.key.publicKeyHash()||e.party2.publicKeyHash(),y=0;y<d.length;y++)if(["transaction","origination","delegation"].includes(d[y].kind)){l=!0,p.push(e.getManager(g)),p.push(e.getCounter(g));break}return Promise.all(p).then(function(){var r=f()(u.a.mark((function r(a){var o,c,p,f,y,b,v,k,m;return u.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(o=i()(a,4),c=o[0],p=o[1],f=o[2],y=o[3],n=c,l&&((p.next_protocol===$["005"]?f:f.key)||(b={kind:"reveal",fee:1420,public_key:h,source:g,gas_limit:10600,storage_limit:300},d.unshift(b)),t=parseInt(y,10),(!e._counters[g]||e._counters[g]<t)&&(e._counters[g]=t)),v=function(r){return r.map((function(r){var t=Me({},r);if(["proposals","ballot","transaction","origination","delegation"].includes(r.kind)&&void 0===r.source&&(t.source=g),["reveal","transaction","origination","delegation"].includes(r.kind)){void 0===r.fee?t.fee="0":t.fee="".concat(r.fee),void 0===r.gas_limit?t.gas_limit="0":t.gas_limit="".concat(r.gas_limit),void 0===r.storage_limit?t.storage_limit="0":t.storage_limit="".concat(r.storage_limit),void 0!==r.balance&&(t.balance="".concat(t.balance)),void 0!==r.amount&&(t.amount="".concat(t.amount));var n=++e._counters[g];t.counter="".concat(n)}return p.next_protocol===$["005"]&&(delete t.manager_pubkey,delete t.spendable,delete t.delegatable),t}))},s.branch=n.hash,s.contents=v(d),k="",e._localForge&&!e._validateLocalForge){r.next=11;break}return r.next=10,e.query("/chains/".concat(e.chain,"/blocks/").concat(n.hash,"/helpers/forge/operations"),s);case 10:k=r.sent;case 11:if(s.protocol=p.next_protocol,e._localForge){r.next=14;break}return r.abrupt("return",{opbytes:k,opOb:s,counter:t});case 14:return r.next=16,Ae.forge(s,t,p.next_protocol);case 16:if(m=r.sent,!e._validateLocalForge){r.next=21;break}if(m.opbytes!==k){r.next=20;break}return r.abrupt("return",m);case 20:throw new Error("Forge validation error - local and remote bytes don't match");case 21:return r.abrupt("return",Me({},m,{counter:t}));case 22:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}())})),O()(k()(e),"simulateOperation",(function(r){var t=r.operation,n=r.source;return e.prepareOperation({operation:t,source:n}).then((function(r){return e.query("/chains/".concat(e.chain,"/blocks/head/helpers/scripts/run_operation"),r.opOb)}))})),O()(k()(e),"sendOperation",function(){var r=f()(u.a.mark((function r(t){var n,a,i,o,c,s,p,f,l,d,h,g;return u.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=t.operation,a=t.source,i=t.skipPrevalidation,o=void 0!==i&&i,c=t.skipSignature,s=void 0!==c&&c,r.next=3,e.prepareOperation({operation:n,source:a});case 3:if(p=r.sent,!e.key||!e.key.isLedger){r.next=14;break}return r.next=7,Ne.signOperation({path:e.key.ledgerPath,rawTxHex:p.opbytes,curve:e.key.ledgerCurve});case 7:f=r.sent,l=G.hex2buf(f),d=G.b58cencode(l,Q["".concat(e.key&&e.key.curve||"ed","sig")]),p.opbytes+=f,p.opOb.signature=d,r.next=31;break;case 14:if(!s){r.next=19;break}p.opbytes+="00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",p.opOb.signature="edsigtXomBKi5CTRf5cjATJWSyaRvhfYNHqSUGrn4SdbYRcGwQrUGjzEfQDTuqHhuA8b2d8NarZjz8TRf65WkpQmo423BtomS8Q",r.next=31;break;case 19:if(!e.key){r.next=25;break}return r.next=22,e.key.sign(p.opbytes,Y.generic);case 22:r.t0=r.sent,r.next=28;break;case 25:return r.next=27,e.party2.sign(p.opbytes,Y.generic);case 27:r.t0=r.sent;case 28:h=r.t0,p.opbytes=h.sbytes,p.opOb.signature=h.prefixSig;case 31:if(g=a||e.key&&e.key.publicKeyHash()||e.party2.publicKeyHash(),!o){r.next=34;break}return r.abrupt("return",e.silentInject(p.opbytes).catch((function(r){throw e._counters[g]=p.counter,r})));case 34:return r.abrupt("return",e.inject(p.opOb,p.opbytes).catch((function(r){throw e._counters[g]=p.counter,r})));case 35:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}()),O()(k()(e),"inject",(function(r,t){var n=[],a=[];return e.query("/chains/".concat(e.chain,"/blocks/head/helpers/preapply/operations"),[r]).then((function(r){if(!Array.isArray(r))throw new Error("RPC Fail");for(var i=0;i<r.length;i++)for(var o=0;o<r[i].contents.length;o++)n.push(r[i].contents[o]),void 0!==r[i].contents[o].metadata.operation_result&&"failed"===r[i].contents[o].metadata.operation_result.status&&(a=a.concat(r[i].contents[o].metadata.operation_result.errors));if(a.length)throw new Error(JSON.stringify({error:"Operation Failed",errors:a}));return e.query("/injection/operation",t)})).then((function(e){return{hash:e,operations:n}}))})),O()(k()(e),"silentInject",(function(r){return e.query("/injection/operation",r).then((function(e){return{hash:e}}))})),O()(k()(e),"transfer",(function(r){var t=r.to,n=r.amount,a=r.source,i=r.fee,o=void 0===i?e.defaultFee:i,c=r.parameter,s=r.gasLimit,u=void 0===s?10600:s,p=r.storageLimit,f=void 0===p?300:p,l=r.mutez,d={kind:"transaction",fee:o,gas_limit:u,storage_limit:f,amount:void 0!==l&&l?G.mutez(n):n,destination:t};return c&&(d.parameters="string"==typeof c?G.sexp2mic(c):c),e.sendOperation({operation:[d],source:a})})),O()(k()(e),"activate",(function(r,t){var n={kind:"activate_account",pkh:r,secret:t};return e.sendOperation({operation:[n],source:r,skipSignature:!0})})),O()(k()(e),"originate",function(){var r=f()(u.a.mark((function r(t){var n,a,i,o,c,s,p,f,l,d,h,g,y,b,v,k,m,_,x;return u.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=t.balance,a=t.code,i=t.init,o=t.spendable,c=void 0!==o&&o,s=t.delegatable,p=void 0!==s&&s,f=t.delegate,l=t.fee,d=void 0===l?e.defaultFee:l,h=t.gasLimit,g=void 0===h?10600:h,y=t.storageLimit,b=void 0===y?257:y,v="string"==typeof a?G.ml2mic(a):a,k="string"==typeof i?G.sexp2mic(i):i,m={code:v,storage:k},_=e.key&&e.key.publicKeyHash()||e.party2.publicKeyHash(),x={kind:"origination",fee:d,gas_limit:g,storage_limit:b,balance:G.mutez(n),manager_pubkey:_,spendable:c,delegatable:p,script:m},f&&(x.delegate=f),r.abrupt("return",e.sendOperation({operation:[x]}));case 8:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}()),O()(k()(e),"setDelegate",function(){var r=f()(u.a.mark((function r(t){var n,a,i,o,c,s,p,f,l;return u.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=t.delegate,a=t.source,i=void 0===a?e.key&&e.key.publicKeyHash()||e.party2.publicKeyHash():a,o=t.fee,c=void 0===o?e.defaultFee:o,s=t.gasLimit,p=void 0===s?10600:s,f=t.storageLimit,l={kind:"delegation",source:i,fee:c,gas_limit:p,storage_limit:void 0===f?0:f,delegate:n},r.abrupt("return",e.sendOperation({operation:[l],source:i}));case 3:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}()),O()(k()(e),"registerDelegate",f()(u.a.mark((function r(){var t,n,a,i,o,c,s,p=arguments;return u.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return t=p.length>0&&void 0!==p[0]?p[0]:{},n=t.fee,a=void 0===n?e.defaultFee:n,i=t.gasLimit,o=void 0===i?10600:i,c=t.storageLimit,s={kind:"delegation",fee:a,gas_limit:o,storage_limit:void 0===c?0:c,delegate:e.key&&e.key.publicKeyHash()||e.party2.publicKeyHash()},r.abrupt("return",e.sendOperation({operation:[s]}));case 3:case"end":return r.stop()}}),r)})))),O()(k()(e),"typecheckCode",(function(r){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e4;return t="string"==typeof r?G.ml2mic(r):r,e.query("/chains/".concat(e.chain,"/blocks/head/helpers/scripts/typecheck_code"),{program:t,gas:n})})),O()(k()(e),"packData",(function(r,t){var n={data:"string"==typeof r?G.sexp2mic(r):r,type:"string"==typeof t?G.sexp2mic(t):t,gas:"4000000"};return e.query("/chains/".concat(e.chain,"/blocks/head/helpers/scripts/pack_data"),n)})),O()(k()(e),"typecheckData",(function(r,t){"string"==typeof r&&G.sexp2mic(r),"string"==typeof t&&G.sexp2mic(t);var n={data:r,type:t,gas:"4000000"};return e.query("/chains/".concat(e.chain,"/blocks/head/helpers/scripts/typecheck_data"),n)})),O()(k()(e),"runCode",(function(r,t,n,a){var i,o,c,s=arguments.length>4&&void 0!==arguments[4]&&arguments[4],u=s?"trace_code":"run_code";return i="string"==typeof r?G.sexp2mic(r):r,o="string"==typeof n?G.sexp2mic(n):n,c="string"==typeof a?G.sexp2mic(a):a,e.query("/chains/".concat(e.chain,"/blocks/head/helpers/scripts/").concat(u),{script:i,amount:"".concat(G.mutez(t)),input:o,storage:c})})),e._defaultFee=a.defaultFee||1420,e._localForge=!1!==a.localForge,e._validateLocalForge=a.validateLocalForge||!1,e._debugMode=a.debugMode||!1,e._counters={},e}return E()(r,e),g()(r,[{key:"setProvider",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.chain;w()(_()(r.prototype),"setProvider",this).call(this,e,t),this.provider=e,this.chain=t}},{key:"defaultFee",get:function(){return this._defaultFee},set:function(e){this._defaultFee=e}},{key:"localForge",get:function(){return this._localForge},set:function(e){this._localForge=e}},{key:"validateLocalForge",get:function(){return this._validateLocalForge},set:function(e){this._validateLocalForge=e}},{key:"counters",get:function(){return this._counters},set:function(e){this._counters=e}},{key:"debugMode",get:function(){return this._debugMode},set:function(e){this._debugMode=e}}]),r}(T),ze=t(17),He=function(){var e=f()(u.a.mark((function e(r){var t,n,a,i,o,c,s,p,f,l,d,h=arguments;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=h.length>1&&void 0!==h[1]?h[1]:"",e.prev=1,e.next=4,U.ready;case 4:e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(1),new Error(e.t0);case 9:if(n=U,a=r.substr(0,2),[54,55,88,98].includes(r.length)){e.next=13;break}throw new Error("Invalid length for a key encoding");case 13:if(i="e"===r.substring(2,3),"ed"!==a){e.next=30;break}if(!i){e.next=24;break}if(o=I()(G.b58cdecode(r,Q.edesk)),c=o.slice(0,8),s=o.slice(8),t){e.next=21;break}throw new Error("No password was provided to decrypt the key");case 21:return p=C.pbkdf2Sync(t,c,32768,32,"sha512"),f=n.crypto_sign_seed_keypair(n.crypto_secretbox_open_easy(s,new Uint8Array(24),p)),e.abrupt("return",{sk:G.b58cencode(f.privateKey,Q.edsk),pk:G.b58cencode(f.publicKey,Q.edpk),pkh:G.b58cencode(n.crypto_generichash(20,f.publicKey),Q.tz1)});case 24:if(98!==r.length){e.next=26;break}return e.abrupt("return",{sk:r,pk:G.b58cencode(G.b58cdecode(r,Q.edsk).slice(32),Q.edpk),pkh:G.b58cencode(n.crypto_generichash(20,G.b58cdecode(r,Q.edsk).slice(32)),Q.tz1)});case 26:if(54!==r.length){e.next=30;break}return l=G.b58cdecode(r,Q.edsk2),d=n.crypto_sign_seed_keypair(l),e.abrupt("return",{sk:G.b58cencode(d.privateKey,Q.edsk),pk:G.b58cencode(d.publicKey,Q.edpk),pkh:G.b58cencode(n.crypto_generichash(20,d.publicKey),Q.tz1)});case 30:return console.error("Invalid prefix for a key encoding"),e.abrupt("return",{sk:"",pk:"",pkh:""});case 32:case"end":return e.stop()}}),e,null,[[1,6]])})));return function(r){return e.apply(this,arguments)}}(),Re=function(){var e=f()(u.a.mark((function e(r,t){var n,a,i;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,U.ready;case 3:e.next=8;break;case 5:throw e.prev=5,e.t0=e.catch(0),new Error(e.t0);case 8:return n=U,e.next=11,Object(ze.mnemonicToSeed)(r,t).then((function(e){return e.slice(0,32)}));case 11:return a=e.sent,i=n.crypto_sign_seed_keypair(I()(a)),e.abrupt("return",{mnemonic:r,passphrase:t,sk:G.b58cencode(i.privateKey,Q.edsk),pk:G.b58cencode(i.publicKey,Q.edpk),pkh:G.b58cencode(n.crypto_generichash(20,i.publicKey),Q.tz1)});case 14:case"end":return e.stop()}}),e,null,[[0,5]])})));return function(r,t){return e.apply(this,arguments)}}(),Ge=function(){var e=f()(u.a.mark((function e(r,t,n){var a,i,o,c,s,p,f,l,d=arguments;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=d.length>3&&void 0!==d[3]?d[3]:"",e.prev=1,e.next=4,U.ready;case 4:e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(1),new Error(e.t0);case 9:if(i=U,54!==t.length&&55!==t.length){e.next=21;break}return e.prev=11,e.next=14,He(t,a);case 14:o=e.sent,t=o.sk,e.next=21;break;case 18:throw e.prev=18,e.t1=e.catch(11),new Error(e.t1);case 21:return c=G.hex2buf(r),void 0!==n&&(c=G.mergebuf(n,c)),s=i.crypto_sign_detached(i.crypto_generichash(32,c),G.b58cdecode(t,Q.edsk),"uint8array"),p=G.b58cencode(s,Q.edsig),f=I()(s),l=r+G.buf2hex(f),e.abrupt("return",{bytes:r,sig:G.b58cencode(s,Q.sig),prefixSig:p,sbytes:l});case 28:case"end":return e.stop()}}),e,null,[[1,6],[11,18]])})));return function(r,t,n){return e.apply(this,arguments)}}(),Qe={extractKeys:He,generateKeys:Re,checkAddress:function(e){try{return G.b58cdecode(e,Q.tz1),!0}catch(e){return!1}},generateMnemonic:function(){return Object(ze.generateMnemonic)(160)},sign:Ge},Ye=t(12);t.d(r,"Key",(function(){return re})),t.d(r,"crypto",(function(){return Qe})),t.d(r,"forge",(function(){return Ae})),t.d(r,"utility",(function(){return G})),t.d(r,"ledger",(function(){return Ne})),t.d(r,"constants",(function(){return ee})),t.d(r,"Ed25519Party1",(function(){return Ye.Party1})),t.d(r,"Ed25519Party2",(function(){return Ye.Ed25519Party2})),t.d(r,"Ed25519Party2Share",(function(){return Ye.Ed25519Party2Share}));r.default=De}])}));