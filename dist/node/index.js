!function(e,r){if("object"==typeof exports&&"object"==typeof module)module.exports=r();else if("function"==typeof define&&define.amd)define([],r);else{var t=r();for(var n in t)("object"==typeof exports?exports:e)[n]=t[n]}}(global,function(){return function(e){var r={};function t(n){if(r[n])return r[n].exports;var a=r[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,t),a.l=!0,a.exports}return t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:n})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,r){if(1&r&&(e=t(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(t.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var a in e)t.d(n,a,function(r){return e[r]}.bind(null,a));return n},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},t.p="",t(t.s=25)}([function(e,r){e.exports=require("@babel/runtime/helpers/defineProperty")},function(e,r){e.exports=require("@babel/runtime/regenerator")},function(e,r){e.exports=require("@babel/runtime/helpers/assertThisInitialized")},function(e,r){e.exports=require("@babel/runtime/helpers/asyncToGenerator")},function(e,r){e.exports=require("libsodium-wrappers")},function(e,r){e.exports=require("bignumber.js")},function(e,r){e.exports=require("@babel/runtime/helpers/classCallCheck")},function(e,r){e.exports=require("@babel/runtime/helpers/createClass")},function(e,r){e.exports=require("bs58check")},function(e,r){e.exports=require("pbkdf2")},function(e,r){e.exports=require("@babel/runtime/helpers/toConsumableArray")},function(e,r){e.exports=require("@babel/runtime/helpers/objectSpread")},function(e,r){e.exports=require("secp256k1")},function(e,r){e.exports=require("secp256r1")},function(e,r){e.exports=require("@ledgerhq/hw-transport-node-hid")},function(e,r){e.exports=require("@babel/runtime/helpers/getPrototypeOf")},function(e,r){e.exports=require("bip39")},function(e,r){e.exports=require("@babel/runtime/helpers/slicedToArray")},function(e,r){e.exports=require("@babel/runtime/helpers/possibleConstructorReturn")},function(e,r){e.exports=require("@babel/runtime/helpers/get")},function(e,r){e.exports=require("@babel/runtime/helpers/inherits")},function(e,r){e.exports=require("xhr2")},function(e,r){e.exports=require("typedarray-to-buffer")},function(e,r){e.exports=require("blake2b")},function(e,r){e.exports=require("buffer")},function(e,r,t){"use strict";t.r(r);var n=t(17),a=t.n(n),i=t(10),o=t.n(i),c=t(11),s=t.n(c),u=t(1),p=t.n(u),f=t(3),l=t.n(f),d=t(6),h=t.n(d),g=t(7),b=t.n(g),v=t(18),y=t.n(v),k=t(2),m=t.n(k),_=t(15),w=t.n(_),x=t(19),A=t.n(x),E=t(20),S=t.n(E),O=t(0),T=t.n(O),K=t(21),B=t.n(K),C=function(){function e(r,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"main",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};h()(this,e),T()(this,"_provider",void 0),T()(this,"_network",void 0),T()(this,"_defaultFee",void 0),T()(this,"_chain",void 0),this._provider=r,this._network=n,this._chain=t,this._defaultFee=a.defaultFee||1278}return b()(e,[{key:"setProvider",value:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.chain,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.network;this._provider=e,this._chain=r,this._network=t}},{key:"provider",get:function(){return this._provider},set:function(e){this._provider=e}},{key:"network",get:function(){return this._network},set:function(e){this._network=e}},{key:"chain",get:function(){return this._chain},set:function(e){this._chain=e}},{key:"defaultFee",get:function(){return this._defaultFee},set:function(e){this._defaultFee=e}}]),e}(),I=t(4),U=t.n(I),P=t(9),q=t.n(P),L=t(12),F=t.n(L),N=t(13),z=t.n(N),j=t(22),M=t.n(j),R=t(8),H=t.n(R),D=t(5);"undefined"==typeof Buffer&&(Buffer=t(24));var G={textEncode:function(e){return new Uint8Array(Buffer.from(e,"utf8"))},textDecode:function(e){return Buffer.from(e).toString("utf8")},b582int:function(e){for(var r=new D.BigNumber(0),t="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz",n=0;n<e.length;n++)r=r.plus(new D.BigNumber(t.indexOf(e[e.length-1-n])).multipliedBy(new D.BigNumber(t.length).exponentiatedBy(n)));return r.toString(16)},totez:function(e){if("number"==typeof e)return e/1e6;if("string"==typeof e)return parseInt(e,10)/1e6;throw new TypeError('Invalid parameter for "mutez" provided.')},mutez:function(e){return new D.BigNumber(new D.BigNumber(e).toFixed(6)).multipliedBy(1e6).toString()},b58cencode:function(e,r){var t=new Uint8Array(r.length+e.length);return t.set(r),t.set(e,r.length),H.a.encode(Buffer.from(t,"hex"))},b58cdecode:function(e,r){return H.a.decode(e).slice(r.length)},buf2hex:function(e){var r=new Uint8Array(e),t=[];return r.forEach(function(e){var r=e.toString(16),n="00".concat(r).slice(-2);t.push(n)}),t.join("")},hex2buf:function(e){return new Uint8Array(e.match(/[\da-f]{2}/gi).map(function(e){return parseInt(e,16)}))},hexNonce:function(e){for(var r="";e--;)r+="0123456789abcedf"[16*Math.random()|0];return r},mergebuf:function(e,r){var t=new Uint8Array(e.length+r.length);return t.set(e),t.set(r,e.length),t},sexp2mic:function e(r){"("===(r=r.replace(/(?:@[a-z_]+)|(?:#.*$)/gm,"").replace(/\s+/g," ").trim()).charAt(0)&&(r=r.slice(1,-1));for(var t=0,n=!1,a=!1,i={prim:"",args:[]},o="",c=0;c<r.length;c++)if(a)o+=r[c],a=!1;else if(c===r.length-1&&!1===n||" "===r[c]&&0===t&&!1===n){if(c===r.length-1&&(o+=r[c]),o){if(o===parseInt(o,10).toString()){if(!i.prim)return{int:o};i.args.push({int:o})}else if("0"===o[0]){if(!i.prim)return{bytes:o};i.args.push({bytes:o})}else i.prim?i.args.push(e(o)):i.prim=o;o=""}}else if('"'===r[c]&&n){if(n=!1,!i.prim)return{string:o};i.args.push({string:o}),o=""}else'"'!==r[c]||n||0!==t?("\\"===r[c]?a=!0:"("===r[c]?t++:")"===r[c]&&t--,o+=r[c]):n=!0;return i},mic2arr:function e(r){var t=[];if(Object.prototype.hasOwnProperty.call(r,"prim"))"Pair"===r.prim?(t.push(e(r.args[0])),t=t.concat(e(r.args[1]))):"Elt"===r.prim?t={key:e(r.args[0]),val:e(r.args[1])}:"True"===r.prim?t=!0:"False"===r.prim&&(t=!1);else if(Array.isArray(r))for(var n=r.length,a=0;a<n;a++){var i=e(r[a]);void 0!==i.key?(Array.isArray(t)&&(t={keys:[],vals:[]}),t.keys.push(i.key),t.vals.push(i.val)):t.push(i)}else t=Object.prototype.hasOwnProperty.call(r,"string")?r.string:Object.prototype.hasOwnProperty.call(r,"int")?parseInt(r.int,10):r;return t},ml2mic:function e(r){for(var t=[],n=!1,a="",i="",o=0,c=0,s=!1,u=!1,p=0;p<r.length;p++){if("}"!==i&&";"!==i||(i=""),n){if("}"===r[p]?c--:"{"===r[p]&&c++,0===c){var f=e(i);t.push({prim:a.trim(),args:[f]}),i="",c=0,n=!1}}else{if("{"===r[p]){c++,a=i,i="",n=!0;continue}if(u){i+=r[p],u=!1;continue}if(p===r.length-1&&!1===s||";"===r[p]&&0===o&&!1===s){if(p===r.length-1&&(i+=r[p]),""===i.trim()||"}"===i.trim()||";"===i.trim()){i="";continue}t.push(G.sexp2mic(i)),i="";continue}'"'===r[p]&&s?s=!1:'"'!==r[p]||s?"\\"===r[p]?u=!0:"("===r[p]?o++:")"===r[p]&&o--:s=!0}i+=r[p]}return t}};G.ml2tzjson=G.sexp2mic,G.tzjson2arr=G.mic2arr,G.mlraw2json=G.ml2mic,G.mintotz=G.totez,G.tztomin=G.mutez;var Q,V=G,W={tz1:new Uint8Array([6,161,159]),tz2:new Uint8Array([6,161,161]),tz3:new Uint8Array([6,161,164]),KT:new Uint8Array([2,90,121]),edpk:new Uint8Array([13,15,37,217]),edsk2:new Uint8Array([13,15,58,7]),spsk:new Uint8Array([17,162,224,201]),p2sk:new Uint8Array([16,81,238,189]),sppk:new Uint8Array([3,254,226,86]),p2pk:new Uint8Array([3,178,139,127]),edesk:new Uint8Array([7,90,60,179,41]),edsk:new Uint8Array([43,246,78,7]),edsig:new Uint8Array([9,245,205,134,18]),spsig:new Uint8Array([13,115,101,19,63]),p2sig:new Uint8Array([54,240,44,52]),sig:new Uint8Array([4,130,43]),Net:new Uint8Array([87,82,0]),nce:new Uint8Array([69,220,169]),b:new Uint8Array([1,52]),o:new Uint8Array([5,116]),Lo:new Uint8Array([133,233]),LLo:new Uint8Array([29,159,109]),P:new Uint8Array([2,170]),Co:new Uint8Array([79,179]),id:new Uint8Array([153,103]),TZ:new Uint8Array([2,90,121])},Y={block:new Uint8Array([1]),endorsement:new Uint8Array([2]),generic:new Uint8Array([3])},X={"00":"parameter","01":"storage","02":"code","03":"False","04":"Elt","05":"Left","06":"None","07":"Pair","08":"Right","09":"Some","0A":"True","0B":"Unit","0C":"PACK","0D":"UNPACK","0E":"BLAKE2B","0F":"SHA256",10:"SHA512",11:"ABS",12:"ADD",13:"AMOUNT",14:"AND",15:"BALANCE",16:"CAR",17:"CDR",18:"CHECK_SIGNATURE",19:"COMPARE","1A":"CONCAT","1B":"CONS","1C":"CREATE_ACCOUNT","1D":"CREATE_CONTRACT","1E":"IMPLICIT_ACCOUNT","1F":"DIP",20:"DROP",21:"DUP",22:"EDIV",23:"EMPTY_MAP",24:"EMPTY_SET",25:"EQ",26:"EXEC",27:"FAILWITH",28:"GE",29:"GET","2A":"GT","2B":"HASH_KEY","2C":"IF","2D":"IF_CONS","2E":"IF_LEFT","2F":"IF_NONE",30:"INT",31:"LAMBDA",32:"LE",33:"LEFT",34:"LOOP",35:"LSL",36:"LSR",37:"LT",38:"MAP",39:"MEM","3A":"MUL","3B":"NEG","3C":"NEQ","3D":"NIL","3E":"NONE","3F":"NOT",40:"NOW",41:"OR",42:"PAIR",43:"PUSH",44:"RIGHT",45:"SIZE",46:"SOME",47:"SOURCE",48:"SENDER",49:"SELF","4A":"STEPS_TO_QUOTA","4B":"SUB","4C":"SWAP","4D":"TRANSFER_TOKENS","4E":"SET_DELEGATE","4F":"UNIT",50:"UPDATE",51:"XOR",52:"ITER",53:"LOOP_LEFT",54:"ADDRESS",55:"CONTRACT",56:"ISNAT",57:"CAST",58:"RENAME",59:"bool","5A":"contract","5B":"int","5C":"key","5D":"key_hash","5E":"lambda","5F":"list",60:"map",61:"big_map",62:"nat",63:"option",64:"or",65:"pair",66:"set",67:"signature",68:"string",69:"bytes","6A":"mutez","6B":"timestamp","6C":"unit","6D":"operation","6E":"address","6F":"SLICE"},Z=(Q={},Object.keys(X).forEach(function(e){Q[X[e]]=e}),Q),J={opMapping:X,opMappingReverse:Z,primMapping:{"00":"int","01":"string","02":"seq","03":{name:"prim",len:0,annots:!1},"04":{name:"prim",len:0,annots:!0},"05":{name:"prim",len:1,annots:!1},"06":{name:"prim",len:1,annots:!0},"07":{name:"prim",len:2,annots:!1},"08":{name:"prim",len:2,annots:!0},"09":{name:"prim",len:3,annots:!0},"0A":"bytes"},primMappingReverse:{0:{false:"03",true:"04"},1:{false:"05",true:"06"},2:{false:"07",true:"08"},3:{true:"09"}},forgeOpTags:{endorsement:0,seed_nonce_revelation:1,double_endorsement_evidence:2,double_baking_evidence:3,activate_account:4,proposals:5,ballot:6,reveal:7,transaction:8,origination:9,delegation:10}},$=function(){function e(r,t,n){var a=this;h()(this,e),T()(this,"_curve",void 0),T()(this,"_publicKey",void 0),T()(this,"_secretKey",void 0),T()(this,"_isSecret",void 0),T()(this,"_isLedger",void 0),T()(this,"_ledgerPath",void 0),T()(this,"_ledgerCurve",void 0),T()(this,"ready",void 0),T()(this,"publicKey",function(){return V.b58cencode(a._publicKey,W["".concat(a._curve,"pk")])}),T()(this,"secretKey",function(){if(!a._secretKey)throw new Error("Secret key not known.");var e=a._secretKey;if("ed"===a._curve){var r=U.a.crypto_sign_seed_keypair(e.slice(0,32));e=r.privateKey}return V.b58cencode(e,W["".concat(a._curve,"sk")])}),T()(this,"publicKeyHash",function(){var e={ed:W.tz1,sp:W.tz2,p2:W.tz3}[a._curve];return V.b58cencode(U.a.crypto_generichash(20,a._publicKey),e)}),T()(this,"initialize",function(){var e=l()(p.a.mark(function e(r,t,n,i){var o,c,s,u,f,l,d,h,g,b,v,y,k;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,U.a.ready;case 2:if(!n){e.next=14;break}if(t){e.next=5;break}throw new Error("Fundraiser key provided without a passphrase.");case 5:return o=V.textDecode(V.textEncode("".concat(n).concat(t))).normalize("NFKD"),c=q.a.pbkdf2Sync(r,"mnemonic".concat(o),2048,64,"sha512"),s=U.a.crypto_sign_seed_keypair(c.slice(0,32)),u=s.publicKey,f=s.privateKey,a._publicKey=u,a._secretKey=f,a._curve="ed",a._isSecret=!0,i(),e.abrupt("return");case 14:if(a._curve=r.substr(0,2),["sp","p2","ed"].includes(a._curve)){e.next=17;break}throw new Error("Invalid prefix for a key encoding.");case 17:if([54,55,88,98].includes(r.length)){e.next=19;break}throw new Error("Invalid length for a key encoding");case 19:if(l="e"===r.substring(2,3),d=l?r.slice(3,5):r.slice(2,4),["pk","sk"].includes(d)){e.next=23;break}throw new Error("Invalid prefix for a key encoding.");case 23:if(a._isSecret="sk"===d,r=a._isSecret?V.b58cdecode(r,W["".concat(a._curve).concat(l?"e":"","sk")]):V.b58cdecode(r,W["".concat(a._curve,"pk")]),!l){e.next=32;break}if(t){e.next=28;break}throw new Error("Encrypted key provided without a passphrase.");case 28:h=r.slice(0,8),g=r.slice(8),b=q.a.pbkdf2Sync(t,h,32768,32,"sha512"),r=U.a.crypto_secretbox_open_easy(g,new Uint8Array(24),b);case 32:if(a._isSecret){e.next=37;break}a._publicKey=r,a._secretKey=void 0,e.next=51;break;case 37:if(a._secretKey=r,"ed"!==a._curve){e.next=42;break}64===r.length?a._publicKey=r.slice(32):(v=U.a.crypto_sign_seed_keypair(r,"uint8array"),y=v.publicKey,k=v.privateKey,a._publicKey=y,a._secretKey=k),e.next=51;break;case 42:if("sp"!==a._curve){e.next=46;break}a._publicKey=F.a.publicKeyCreate(r),e.next=51;break;case 46:if("p2"!==a._curve){e.next=50;break}a._publicKey=z.a.publicKeyCreate(r),e.next=51;break;case 50:throw new Error("Invalid key");case 51:i();case 52:case"end":return e.stop()}},e)}));return function(r,t,n,a){return e.apply(this,arguments)}}()),T()(this,"sign",function(){var e=l()(p.a.mark(function e(r,t){var n,i,o,c,s,u,f,l,d,h;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=V.hex2buf(r),void 0!==t&&(n=V.mergebuf(t,n)),i=M()(U.a.crypto_generichash(32,n)),a._secretKey){e.next=5;break}throw new Error("Cannot sign operations without a secret key.");case 5:if("ed"!==a._curve){e.next=11;break}return o=U.a.crypto_sign_detached(i,a._secretKey),c=r+V.buf2hex(o),e.abrupt("return",{bytes:r,sig:V.b58cencode(o,W.sig),prefixSig:V.b58cencode(o,W.edsig),sbytes:c});case 11:if("sp"!==a._curve){e.next=17;break}return s=F.a.sign(i,a._secretKey),u=s.signature,f=r+V.buf2hex(u),e.abrupt("return",{bytes:r,sig:V.b58cencode(u,W.sig),prefixSig:V.b58cencode(u,W.spsig),sbytes:f});case 17:if("p2"!==a._curve){e.next=21;break}return l=z.a.sign(i,a._secretKey),d=l.signature,h=r+V.buf2hex(d),e.abrupt("return",{bytes:r,sig:V.b58cencode(d,W.sig),prefixSig:V.b58cencode(d,W.p2sig),sbytes:h});case 21:throw new Error("Provided curve not supported");case 22:case"end":return e.stop()}},e)}));return function(r,t){return e.apply(this,arguments)}}()),T()(this,"verify",function(e,r){if(!a._publicKey)throw new Error("Cannot verify without a public key");if("sig"!==r.slice(0,3)&&a._curve!==r.slice(0,2))throw new Error("Signature and public key curves mismatch.");if("ed"!==a._curve){if("sp"===a._curve)return F.a.verify(e,r,a._publicKey);if("p2"===a._curve)return z.a.verify(e,r,a._publicKey);throw new Error("Curve '".concat(a._curve,"' not supported"))}var t=V.hex2buf(e);try{return U.a.crypto_sign_verify_detached(r,t,a._publicKey)}catch(e){throw new Error("Signature is invalid.")}}),this._isLedger=!1,this._ledgerPath="44'/1729'/0'/0'",this._ledgerCurve=0,this.ready=new Promise(function(e){a.initialize(r,t,n,e)})}return b()(e,[{key:"curve",get:function(){return this._curve}},{key:"isLedger",get:function(){return this._isLedger},set:function(e){this._isLedger=e}},{key:"ledgerPath",get:function(){return this._ledgerPath},set:function(e){this._ledgerPath=e}},{key:"ledgerCurve",get:function(){return this._ledgerCurve},set:function(e){this._ledgerCurve=e}}]),e}(),ee={toBytesInt32:function(e){return e=parseInt(e,10),new Uint8Array([(4278190080&e)>>24,(16711680&e)>>16,(65280&e)>>8,255&e]).buffer},toBytesInt32Hex:function(e){return V.buf2hex(ee.toBytesInt32(e))},bool:function(e){return e?"ff":"00"},script:function(e){var r=ee.encodeRawBytes(e.code).toLowerCase(),t=ee.encodeRawBytes(e.storage).toLowerCase();return ee.toBytesInt32Hex(r.length/2)+r+ee.toBytesInt32Hex(t.length/2)+t},parameters:function(e){var r=ee.encodeRawBytes(e).toLowerCase();return ee.toBytesInt32Hex(r.length/2)+r},publicKeyHash:function(e){var r=parseInt(e.substr(2,1),10),t="0".concat(r-1);return t+=V.buf2hex(V.b58cdecode(e,W[e.substr(0,3)]))},address:function(e){var r;return"K"===e.substr(0,1)?(r="01",r+=V.buf2hex(V.b58cdecode(e,W.KT)),r+="00"):(r="00",r+=ee.publicKeyHash(e)),r},zarith:function(e){var r="",t=parseInt(e,10);if(Number.isNaN(t))throw new TypeError("Error forging zarith ".concat(e));for(;;){if(t<128){t<16&&(r+="0"),r+=t.toString(16);break}var n=t%128;t-=n,t/=128,r+=(n+=128).toString(16)}return r},publicKey:function(e){var r="";switch(e.substr(0,2)){case"ed":r="00";break;case"sp":r="01";break;case"p2":r="02"}return r+=V.buf2hex(V.b58cdecode(e,W[e.substr(0,4)]))},op:function(e){var r="";switch(r=V.buf2hex(new Uint8Array([J.forgeOpTags[e.kind]])),J.forgeOpTags[e.kind]){case 0:case 1:if(r+=V.buf2hex(ee.toBytesInt32(e.level)),0===J.forgeOpTags[e.kind])break;if(r+=e.nonce,1===J.forgeOpTags[e.kind])break;case 2:case 3:throw new Error("Double bake and double endorse forging is not complete");case 4:if(r+=V.buf2hex(V.b58cdecode(e.pkh,W.tz1)),r+=e.secret,4===J.forgeOpTags[e.kind])break;case 5:case 6:if(r+=ee.publicKeyHash(e.source),r+=V.buf2hex(ee.toBytesInt32(e.period)),5===J.forgeOpTags[e.kind])throw new Error("Proposal forging is not complete");if(6===J.forgeOpTags[e.kind]){r+=V.buf2hex(V.b58cdecode(e.proposal,W.P)),r+="yay"===e.ballot?"00":"nay"===e.ballot?"01":"02";break}case 7:case 8:case 9:case 10:r+=ee.address(e.source),r+=ee.zarith(e.fee),r+=ee.zarith(e.counter),r+=ee.zarith(e.gas_limit),r+=ee.zarith(e.storage_limit),7===J.forgeOpTags[e.kind]?r+=ee.publicKey(e.public_key):8===J.forgeOpTags[e.kind]?(r+=ee.zarith(e.amount),r+=ee.address(e.destination),void 0!==e.parameters&&e.parameters?(r+=ee.bool(!0),r+=ee.parameters(e.parameters)):r+=ee.bool(!1)):9===J.forgeOpTags[e.kind]?(r+=ee.publicKeyHash(e.manager_pubkey),r+=ee.zarith(e.balance),r+=ee.bool(e.spendable),r+=ee.bool(e.delegatable),void 0!==e.delegate&&e.delegate?(r+=ee.bool(!0),r+=ee.publicKeyHash(e.delegate)):r+=ee.bool(!1),void 0!==e.script&&e.script?(r+=ee.bool(!0),r+=ee.script(e.script)):r+=ee.bool(!1)):10===J.forgeOpTags[e.kind]&&(void 0!==e.delegate&&e.delegate?(r+=ee.bool(!0),r+=ee.publicKeyHash(e.delegate)):r+=ee.bool(!1))}return r}};ee.forge=function(){var e=l()(p.a.mark(function e(r,t){var n;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r.contents){e.next=2;break}throw new Error("No operation contents provided.");case 2:if(r.branch){e.next=4;break}throw new Error("No operation branch provided.");case 4:return n=V.buf2hex(V.b58cdecode(r.branch,W.b)),r.contents.forEach(function(e){n+=ee.op(e)}),e.abrupt("return",{opbytes:n,opOb:r,counter:t});case 7:case"end":return e.stop()}},e)}));return function(r,t){return e.apply(this,arguments)}}(),ee.decodeRawBytes=function(e){e=e.toUpperCase();var r=0,t=function(t){return e.slice(r,r+t)};return function e(){var n=t(2),a=J.primMapping[n];if(a instanceof Object){r+=2;var i=J.opMapping[t(2)];r+=2;var c={prim:i,args:o()(Array(a.len)).map(function(){return e()}),annots:void 0};if(a.len||delete c.args,a.annots){var s=2*parseInt(t(8),16);r+=8;var u=t(s).match(/[\dA-F]{2}/g);if(r+=s,u){var p=new Uint8Array(u.map(function(e){return parseInt(e,16)})),f=V.textDecode(p);c.annots=f.split(" ")}}else delete c.annots;return c}if("0A"===n){r+=2;var l=t(8);r+=8;var d=2*parseInt(l,16),h=t(d);return r+=d,{bytes:h}}if("01"===n){r+=2;var g=t(8);r+=8;var b=2*parseInt(g,16),v=t(b);r+=b;var y=v.match(/[\dA-F]{2}/g);if(y instanceof Array){var k=new Uint8Array(y.map(function(e){return parseInt(e,16)}));return{string:V.textDecode(k)}}throw new Error("Input bytes error")}if("00"===n){r+=2;var m=parseInt(t(2),16).toString(2).padStart(8,"0");r+=2;for(var _=[m.slice(2)],w="1"===m[0];w;){var x=parseInt(t(2),16).toString(2).padStart(8,"0");r+=2,_.push(x.slice(1)),w="1"===x[0]}return{int:new D.BigNumber(_.reverse().join(""),2).toString()}}if("02"===n){r+=2;var A=t(8);r+=8;for(var E=2*parseInt(A,16),S=r+E,O=[];S>r;)O.push(e());return O}throw new Error("Invalid raw bytes: Byte:".concat(n," Index:").concat(r))}()},ee.encodeRawBytes=function(e){return function e(r){var t=[];if(r instanceof Array){t.push("02");var n=r.map(function(r){return e(r)}).join(""),a=n.length/2;t.push(a.toString(16).padStart(8,"0")),t.push(n)}else if(r instanceof Object)if(r.prim){var i=r.args?r.args.length:0;if(t.push(J.primMappingReverse[i]["".concat(!!r.annots)]),t.push(J.opMappingReverse[r.prim]),r.args&&r.args.forEach(function(r){return t.push(e(r))}),r.annots){var o=r.annots.map(function(e){return V.buf2hex(V.textEncode(e))}).join("20");t.push((o.length/2).toString(16).padStart(8,"0")),t.push(o)}}else if(r.bytes){var c=r.bytes.length/2;t.push("0A"),t.push(c.toString(16).padStart(8,"0")),t.push(r.bytes)}else if(r.int){var s,u=new D.BigNumber(r.int,10),p="-"===u.toString(2)[0]?"1":"0",f=u.toString(2).replace("-","");s=f.length<=6?6:(f.length-6)%7?(f.length+7-(f.length-6))%7:f.length;var l=f.padStart(s,"0").match(/\d{6,7}/g).reverse();l[0]=p+l[0];var d=l.map(function(e,r){return parseInt((r===l.length-1?"0":"1")+e,2).toString(16).padStart(2,"0")}).join("");t.push("00"),t.push(d)}else if(r.string){var h=V.textEncode(r.string),g=[].slice.call(h).map(function(e){return e.toString(16).padStart(2,"0")}).join(""),b=h.length;t.push("01"),t.push(b.toString(16).padStart(8,"0")),t.push(g)}return t.join("")}(e).toUpperCase()};var re=ee,te=t(14),ne=t.n(te),ae=t(23),ie=t.n(ae);function oe(e){var r=[];return e.split("/").forEach(function(e){var t=parseInt(e,10);Number.isNaN(t)||(e.length>1&&"'"===e[e.length-1]&&(t+=2147483648),r.push(t))}),r}function ce(e,r){return Promise.resolve().then(function(){return function e(t,n,a){return t>=n.length?a:r(n[t],t).then(function(r){return a.push(r),e(t+1,n,a)})}(0,e,[])})}var se=function(e){switch(e){case 0:return Buffer.of(13,15,37,217);case 1:return Buffer.of(3,254,226,86);case 2:return Buffer.of(3,178,139,127);default:return Buffer.of(0)}},ue=function(e){switch(e){case 0:return Buffer.of(6,161,159);case 1:return Buffer.of(6,161,161);case 2:return Buffer.of(6,161,164);default:return Buffer.of(0)}},pe=function(e,r){return e=function(e,r){switch(r){case 0:return(e=e.slice(0))[0]=r,e;case 1:case 2:return Buffer.concat([Buffer.of(r,2+(1&e[64])),e.slice(1,33)]);default:return Buffer.of(0)}}(e,r),{publicKey:fe(e),address:le(e)}},fe=function(e){var r=e[0],t=e.slice(1);return H.a.encode(Buffer.concat([se(r),t]))},le=function(e){var r=e[0],t=e.slice(1),n=ie()(20);return n.update(t),n.digest(n=Buffer.alloc(20)),H.a.encode(Buffer.concat([ue(r),n]))},de=function(){function e(r){h()(this,e),T()(this,"transport",void 0),this.transport=r,r.decorateAppAPIMethods(this,["getAddress","signOperation","getVersion"],"XTZ")}return b()(e,[{key:"getAddress",value:function(e,r,t){var n=oe(e);t=t||0;var a=Buffer.alloc(1+4*n.length);return a[0]=n.length,n.forEach(function(e,r){a.writeUInt32BE(e,1+4*r)}),this.transport.send(128,r?3:2,0,t,a).then(function(e){var r=e[0],n=e.slice(1,1+r);return pe(n,t)})}},{key:"signOperation",value:function(e,r,t){var n,a=this,i=oe(e),o=0,c=Buffer.from(r,"hex"),s=[];t=t||0;var u=Buffer.alloc(4*i.length+1);for(u[0]=i.length,i.forEach(function(e,r){u.writeUInt32BE(e,1+4*r)}),s.push(u);o!==c.length;){var p=void 0;p=o+255>=c.length?c.length-o:255;var f=Buffer.alloc(p);c.copy(f,0,o,o+p),s.push(f),o+=p}return ce(s,function(e,r){var i=1;return 0===r?i=0:r===s.length-1&&(i=129),a.transport.send(128,4,i,t,e).then(function(e){n=e})}).then(function(){return{signature:n.slice(0,n.length-2).toString("hex")}})}},{key:"getVersion",value:function(){return this.transport.send(128,0,0,0,Buffer.alloc(0)).then(function(e){var r=1===e[0];return{major:e[1],minor:e[2],patch:e[3],bakingApp:r}})}}]),e}(),he={};he.getAddress=l()(p.a.mark(function e(){var r,t,n,a,i,o,c,s,u,f,l=arguments;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=l.length>0&&void 0!==l[0]?l[0]:{},t=r.path,n=void 0===t?"44'/1729'/0'/0'":t,a=r.displayConfirm,i=void 0===a||a,o=r.curve,c=void 0===o?0:o,e.next=3,ne.a.create();case 3:return s=e.sent,u=new de(s),e.prev=5,e.next=8,u.getAddress(n,i,c);case 8:f=e.sent,e.next=15;break;case 11:return e.prev=11,e.t0=e.catch(5),s.close(),e.abrupt("return",e.t0);case 15:return s.close(),e.abrupt("return",f);case 17:case"end":return e.stop()}},e,null,[[5,11]])})),he.signOperation=function(){var e=l()(p.a.mark(function e(r){var t,n,a,i,o,c,s,u,f;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.path,n=void 0===t?"44'/1729'/0'/0'":t,a=r.rawTxHex,i=r.curve,o=void 0===i?0:i,e.next=3,ne.a.create();case 3:return c=e.sent,s=new de(c),e.prev=5,e.next=8,s.signOperation(n,"03".concat(a),o);case 8:f=e.sent,u=f.signature,e.next=16;break;case 12:return e.prev=12,e.t0=e.catch(5),c.close(),e.abrupt("return",e.t0);case 16:return c.close(),e.abrupt("return",u);case 18:case"end":return e.stop()}},e,null,[[5,12]])}));return function(r){return e.apply(this,arguments)}}(),he.getVersion=l()(p.a.mark(function e(){var r,t,n;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ne.a.create();case 2:return r=e.sent,t=new de(r),e.prev=4,e.next=7,t.getVersion();case 7:n=e.sent,e.next=14;break;case 10:return e.prev=10,e.t0=e.catch(4),r.close(),e.abrupt("return",e.t0);case 14:return r.close(),e.abrupt("return",n);case 16:case"end":return e.stop()}},e,null,[[4,10]])}));var ge=he,be=function(e){function r(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"http://127.0.0.1:8732",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"main",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"main",c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return h()(this,r),e=y()(this,w()(r).call(this,t,n,i,c)),T()(m()(e),"_localForge",void 0),T()(m()(e),"_validateLocalForge",void 0),T()(m()(e),"_counters",void 0),T()(m()(e),"_debugMode",void 0),T()(m()(e),"key",void 0),T()(m()(e),"importKey",function(){var r=l()(p.a.mark(function r(t,n,a){return p.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return e.key=new $(t,n,a),r.next=3,e.key.ready;case 3:case"end":return r.stop()}},r)}));return function(e,t,n){return r.apply(this,arguments)}}()),T()(m()(e),"importLedger",l()(p.a.mark(function r(){var t,n,a,i,o=arguments;return p.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return t=o.length>0&&void 0!==o[0]?o[0]:"44'/1729'/0'/0'",n=o.length>1&&void 0!==o[1]?o[1]:0,r.next=4,ge.getAddress({path:t,displayConfirm:!0,curve:n});case 4:return a=r.sent,i=a.publicKey,e.key=new $(i),r.next=9,e.key.ready;case 9:e.key&&(e.key.isLedger=!0,e.key.ledgerPath=t,e.key.ledgerCurve=n);case 10:case"end":return r.stop()}},r)}))),T()(m()(e),"query",function(r,t,n){return void 0===t?void 0===n?n="GET":t={}:void 0===n&&(n="POST"),new Promise(function(a,i){try{var o=new B.a;o.open(n,e.provider+r,!0),o.onload=function(){if(e._debugMode&&console.log("Node call:",r,t),200===o.status)if(o.responseText){var n=JSON.parse(o.responseText);e._debugMode&&console.log("Node response:",r,t,n),void 0!==n.error?i(n.error):(void 0!==n.ok&&(n=n.ok),a(n))}else i("Empty response returned");else o.responseText?i(o.responseText):i(o.statusText)},o.onerror=function(){i(o.statusText)},"POST"===n?(o.setRequestHeader("Content-Type","application/json"),o.send(JSON.stringify(t))):o.send()}catch(e){i(e)}})}),T()(m()(e),"account",function(){var r=l()(p.a.mark(function r(t){var n,a,i,o,c,u,f,l,d,h,g,b;return p.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return n=t.balance,a=t.spendable,i=t.delegatable,o=t.delegate,c=t.fee,u=void 0===c?e.defaultFee:c,f=t.gasLimit,l=void 0===f?1e4:f,d=t.storageLimit,h=void 0===d?257:d,g={},void 0!==a&&(g.spendable=a),void 0!==i&&(g.delegatable=i),void 0!==o&&o&&(g.delegate=o),b=[s()({kind:"origination",balance:V.mutez(n),fee:u,gas_limit:l,storage_limit:h,manager_pubkey:e.key.publicKeyHash()},g)],r.abrupt("return",e.sendOperation({operation:b}));case 7:case"end":return r.stop()}},r)}));return function(e){return r.apply(this,arguments)}}()),T()(m()(e),"getBalance",function(r){return e.query("/chains/".concat(e.chain,"/blocks/head/context/contracts/").concat(r,"/balance"))}),T()(m()(e),"getDelegate",function(r){return e.query("/chains/".concat(e.chain,"/blocks/head/context/contracts/").concat(r,"/delegate")).then(function(e){return e||!1})}),T()(m()(e),"getManager",function(r){return e.query("/chains/".concat(e.chain,"/blocks/head/context/contracts/").concat(r,"/manager_key"))}),T()(m()(e),"getCounter",function(r){return e.query("/chains/".concat(e.chain,"/blocks/head/context/contracts/").concat(r,"/counter"))}),T()(m()(e),"getBaker",function(r){return e.query("/chains/".concat(e.chain,"/blocks/head/context/delegates/").concat(r))}),T()(m()(e),"getHeader",function(){return e.query("/chains/".concat(e.chain,"/blocks/head/header"))}),T()(m()(e),"getHead",function(){return e.query("/chains/".concat(e.chain,"/blocks/head"))}),T()(m()(e),"getHeadHash",function(){return e.query("/chains/".concat(e.chain,"/blocks/head/hash"))}),T()(m()(e),"getBallotList",function(){return e.query("/chains/".concat(e.chain,"/blocks/head/votes/ballot_list"))}),T()(m()(e),"getProposals",function(){return e.query("/chains/".concat(e.chain,"/blocks/head/votes/proposals"))}),T()(m()(e),"getBallots",function(){return e.query("/chains/".concat(e.chain,"/blocks/head/votes/ballots"))}),T()(m()(e),"getListings",function(){return e.query("/chains/".concat(e.chain,"/blocks/head/votes/listings"))}),T()(m()(e),"getCurrentProposal",function(){return e.query("/chains/".concat(e.chain,"/blocks/head/votes/current_proposal"))}),T()(m()(e),"getCurrentPeriod",function(){return e.query("/chains/".concat(e.chain,"/blocks/head/votes/current_period_kind"))}),T()(m()(e),"getCurrentQuorum",function(){return e.query("/chains/".concat(e.chain,"/blocks/head/votes/current_quorum"))}),T()(m()(e),"awaitOperation",function(r){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:180;if(n<=0)throw new Error("Timeout must be more than 0");if(t<=0)throw new Error("Interval must be more than 0");var a=Math.ceil(n/t)+1,i=0,o=!1,c=function(e){e.hash===r&&(o=!0)};return new Promise(function(r,n){!function s(){return e.getHead().then(function(e){i++;for(var u=3;u>=0;u--)e.operations[u].forEach(c);o?r(e.hash):i>=a?n(new Error("Timeout")):setTimeout(s,1e3*t)})}()})}),T()(m()(e),"call",function(r,t){return e.query(r,t)}),T()(m()(e),"prepareOperation",function(r){var t,n,i=r.operation,c={},u=[],f=!1,d=[];u.push(e.getHeader()),d=Array.isArray(i)?o()(i):[i];for(var h=e.key.publicKeyHash(),g=0;g<d.length;g++)if(["transaction","origination","delegation"].includes(d[g].kind)){f=!0,u.push(e.getCounter(h)),u.push(e.getManager(h));break}return Promise.all(u).then(function(){var r=l()(p.a.mark(function r(i){var o,u,l,g,b,v,y,k;return p.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(o=a()(i,3),u=o[0],l=o[1],g=o[2],n=u,f&&void 0===g.key&&(b={kind:"reveal",fee:"zero"===e.network?1e5:1269,public_key:e.key.publicKey(),source:h,gas_limit:1e4,storage_limit:0},d.unshift(b)),t=parseInt(l,10),(!e._counters[h]||e._counters[h]<t)&&(e._counters[h]=t),v=function(r){return r.map(function(r){var t=s()({},r);if(["proposals","ballot","transaction","origination","delegation"].includes(r.kind)&&void 0===r.source&&(t.source=h),["reveal","transaction","origination","delegation"].includes(r.kind)){void 0===r.fee?t.fee="0":t.fee="".concat(r.fee),void 0===r.gas_limit?t.gas_limit="0":t.gas_limit="".concat(r.gas_limit),void 0===r.storage_limit?t.storage_limit="0":t.storage_limit="".concat(r.storage_limit),void 0!==r.balance&&(t.balance="".concat(t.balance)),void 0!==r.amount&&(t.amount="".concat(t.amount));var n=++e._counters[h];t.counter="".concat(n)}return t})},c.branch=n.hash,c.contents=v(d),y="",e._localForge&&!e._validateLocalForge){r.next=13;break}return r.next=12,e.query("/chains/".concat(e.chain,"/blocks/").concat(n.hash,"/helpers/forge/operations"),c);case 12:y=r.sent;case 13:if(c.protocol=n.protocol,e._localForge){r.next=16;break}return r.abrupt("return",{opbytes:y,opOb:c,counter:t});case 16:return r.next=18,re.forge(c,t);case 18:if(k=r.sent,!e._validateLocalForge){r.next=23;break}if(k.opbytes!==y){r.next=22;break}return r.abrupt("return",k);case 22:throw new Error("Forge validation error - local and remote bytes don't match");case 23:return r.abrupt("return",s()({},k,{counter:t}));case 24:case"end":return r.stop()}},r)}));return function(e){return r.apply(this,arguments)}}())}),T()(m()(e),"simulateOperation",function(r){var t=r.operation;return e.prepareOperation({operation:t}).then(function(r){return e.query("/chains/".concat(e.chain,"/blocks/head/helpers/scripts/run_operation"),r.opOb)})}),T()(m()(e),"sendOperation",function(){var r=l()(p.a.mark(function r(t){var n,a,i,o,c,s,u,f,l,d,h;return p.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return n=t.operation,a=t.skipPrevalidation,i=void 0!==a&&a,o=t.skipSignature,c=void 0!==o&&o,r.next=3,e.prepareOperation({operation:n});case 3:if(s=r.sent,!e.key.isLedger){r.next=14;break}return r.next=7,ge.signOperation({path:e.key.ledgerPath,rawTxHex:s.opbytes,curve:e.key.ledgerCurve});case 7:u=r.sent,f=V.hex2buf(u),l=V.b58cencode(f,W["".concat(e.key.curve,"sig")]),s.opbytes+=u,s.opOb.signature=l,r.next=24;break;case 14:if(!c){r.next=19;break}s.opbytes+="00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",s.opOb.signature="edsigtXomBKi5CTRf5cjATJWSyaRvhfYNHqSUGrn4SdbYRcGwQrUGjzEfQDTuqHhuA8b2d8NarZjz8TRf65WkpQmo423BtomS8Q",r.next=24;break;case 19:return r.next=21,e.key.sign(s.opbytes,Y.generic);case 21:d=r.sent,s.opbytes=d.sbytes,s.opOb.signature=d.prefixSig;case 24:if(h=e.key.publicKeyHash(),!i){r.next=27;break}return r.abrupt("return",e.silentInject(s.opbytes).catch(function(r){throw e._counters[h]=s.counter,r}));case 27:return r.abrupt("return",e.inject(s.opOb,s.opbytes).catch(function(r){throw e._counters[h]=s.counter,r}));case 28:case"end":return r.stop()}},r)}));return function(e){return r.apply(this,arguments)}}()),T()(m()(e),"inject",function(r,t){var n=[],a=[];return e.query("/chains/".concat(e.chain,"/blocks/head/helpers/preapply/operations"),[r]).then(function(r){if(!Array.isArray(r))throw new Error("RPC Fail");for(var i=0;i<r.length;i++)for(var o=0;o<r[i].contents.length;o++)n.push(r[i].contents[o]),void 0!==r[i].contents[o].metadata.operation_result&&"failed"===r[i].contents[o].metadata.operation_result.status&&(a=a.concat(r[i].contents[o].metadata.operation_result.errors));if(a.length)throw new Error({error:"Operation Failed",errors:a});return e.query("/injection/operation",t)}).then(function(e){return{hash:e,operations:n}})}),T()(m()(e),"silentInject",function(r){return e.query("/injection/operation",r).then(function(e){return{hash:e}})}),T()(m()(e),"transfer",function(r){var t=r.to,n=r.amount,a=r.parameter,i=r.fee,o=void 0===i?e.defaultFee:i,c=r.gasLimit,s=void 0===c?10100:c,u=r.storageLimit,p=void 0===u?0:u,f=r.mutez,l=void 0!==f&&f,d=r.rawParam,h=void 0!==d&&d,g={kind:"transaction",fee:o,gas_limit:s,storage_limit:p,amount:l?V.mutez(n):n,destination:t};return a&&(g.parameters=h?a:V.sexp2mic(a)),e.sendOperation({operation:[g]})}),T()(m()(e),"activate",function(r,t){var n={kind:"activate_account",pkh:r,secret:t};return e.sendOperation({operation:[n],skipSignature:!0})}),T()(m()(e),"originate",function(){var r=l()(p.a.mark(function r(t){var n,a,i,o,c,s,u,f,l,d,h,g,b,v,y,k,m,_;return p.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return n=t.balance,a=t.code,i=t.init,o=t.spendable,c=void 0!==o&&o,s=t.delegatable,u=void 0!==s&&s,f=t.delegate,l=t.fee,d=void 0===l?e.defaultFee:l,h=t.gasLimit,g=void 0===h?1e4:h,b=t.storageLimit,v=void 0===b?257:b,y=V.ml2mic(a),k={code:y,storage:V.sexp2mic(i)},m=e.key.publicKeyHash(),_={kind:"origination",fee:d,gas_limit:g,storage_limit:v,balance:V.mutez(n),manager_pubkey:m,spendable:c,delegatable:u,delegate:void 0!==f&&f?f:m,script:k},r.abrupt("return",e.sendOperation({operation:[_]}));case 6:case"end":return r.stop()}},r)}));return function(e){return r.apply(this,arguments)}}()),T()(m()(e),"setDelegate",function(){var r=l()(p.a.mark(function r(t){var n,a,i,o,c,s,u,f,l;return p.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return n=t.delegate,a=t.fee,i=void 0===a?e.defaultFee:a,o=t.gasLimit,c=void 0===o?1e4:o,s=t.storageLimit,u=void 0===s?0:s,f=e.key.publicKeyHash(),l={kind:"delegation",fee:i,gas_limit:c,storage_limit:u,delegate:void 0!==n?n:f},r.abrupt("return",e.sendOperation({operation:[l]}));case 4:case"end":return r.stop()}},r)}));return function(e){return r.apply(this,arguments)}}()),T()(m()(e),"registerDelegate",function(){var r=l()(p.a.mark(function r(t){var n,a,i,o,c,s,u,f;return p.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return n=t.fee,a=void 0===n?e.defaultFee:n,i=t.gasLimit,o=void 0===i?1e4:i,c=t.storageLimit,s=void 0===c?0:c,u=e.key.publicKeyHash(),f={kind:"delegation",fee:a,gas_limit:o,storage_limit:s,delegate:u},r.abrupt("return",e.sendOperation({operation:[f]}));case 4:case"end":return r.stop()}},r)}));return function(e){return r.apply(this,arguments)}}()),T()(m()(e),"typecheckCode",function(r){var t=V.ml2mic(r);return e.query("/chains/".concat(e.chain,"/blocks/head/helpers/scripts/typecheck_code"),{program:t,gas:"10000"})}),T()(m()(e),"packData",function(r,t){var n={data:V.sexp2mic(r),type:V.sexp2mic(t),gas:"4000000"};return e.query("/chains/".concat(e.chain,"/blocks/head/helpers/scripts/pack_data"),n)}),T()(m()(e),"typecheckData",function(r,t){var n={data:V.sexp2mic(r),type:V.sexp2mic(t),gas:"4000000"};return e.query("/chains/".concat(e.chain,"/blocks/head/helpers/scripts/typecheck_data"),n)}),T()(m()(e),"runCode",function(r,t,n,a){var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4]?"trace_code":"run_code";return e.query("/chains/".concat(e.chain,"/blocks/head/helpers/scripts/").concat(i),{script:V.ml2mic(r),amount:"".concat(V.mutez(t)),input:V.sexp2mic(n),storage:V.sexp2mic(a)})}),e._localForge=c.localForge||!0,e._validateLocalForge=c.validateLocalForge||!1,e._counters={},e._debugMode=c.debugMode||!1,e}return S()(r,e),b()(r,[{key:"setProvider",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.chain,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.network;A()(w()(r.prototype),"setProvider",this).call(this,e,t,n),this.provider=e,this.chain=t,this.network=n}},{key:"localForge",get:function(){return this._localForge},set:function(e){this._localForge=e}},{key:"validateLocalForge",get:function(){return this._validateLocalForge},set:function(e){this._validateLocalForge=e}},{key:"counters",get:function(){return this._counters},set:function(e){this._counters=e}},{key:"debugMode",get:function(){return this._debugMode},set:function(e){this._debugMode=e}}]),r}(C),ve=t(16),ye={};ye.extractKeys=function(){var e=l()(p.a.mark(function e(r){var t,n,a,i,o,c,s,u,f,l,d,h=arguments;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=h.length>1&&void 0!==h[1]?h[1]:"",e.prev=1,e.next=4,U.a.ready;case 4:e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(1),new Error(e.t0);case 9:if(n=U.a,a=r.substr(0,2),[54,55,88,98].includes(r.length)){e.next=13;break}throw new Error("Invalid length for a key encoding");case 13:if(i="e"===r.substring(2,3),"ed"!==a){e.next=30;break}if(!i){e.next=24;break}if(o=V.b58cdecode(r,W.edesk),c=o.slice(0,8),s=o.slice(8),t){e.next=21;break}throw new Error("No password was provided to decrypt the key");case 21:return u=q.a.pbkdf2Sync(t,c,32768,32,"sha512"),f=n.crypto_sign_seed_keypair(n.crypto_secretbox_open_easy(s,new Uint8Array(24),u)),e.abrupt("return",{sk:V.b58cencode(f.privateKey,W.edsk),pk:V.b58cencode(f.publicKey,W.edpk),pkh:V.b58cencode(n.crypto_generichash(20,f.publicKey),W.tz1)});case 24:if(98!==r.length){e.next=26;break}return e.abrupt("return",{sk:r,pk:V.b58cencode(V.b58cdecode(r,W.edsk).slice(32),W.edpk),pkh:V.b58cencode(n.crypto_generichash(20,V.b58cdecode(r,W.edsk).slice(32)),W.tz1)});case 26:if(54!==r.length){e.next=30;break}return l=V.b58cdecode(r,W.edsk2),d=n.crypto_sign_seed_keypair(l),e.abrupt("return",{sk:V.b58cencode(d.privateKey,W.edsk),pk:V.b58cencode(d.publicKey,W.edpk),pkh:V.b58cencode(n.crypto_generichash(20,d.publicKey),W.tz1)});case 30:return console.error("Invalid prefix for a key encoding"),e.abrupt("return",{sk:"",pk:"",pkh:""});case 32:case"end":return e.stop()}},e,null,[[1,6]])}));return function(r){return e.apply(this,arguments)}}(),ye.generateMnemonic=function(){return Object(ve.generateMnemonic)(160)},ye.checkAddress=function(e){try{return V.b58cdecode(e,W.tz1),!0}catch(e){return!1}},ye.generateKeys=function(){var e=l()(p.a.mark(function e(r,t){var n,a,i;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,U.a.ready;case 3:e.next=8;break;case 5:throw e.prev=5,e.t0=e.catch(0),new Error(e.t0);case 8:return n=U.a,e.next=11,Object(ve.mnemonicToSeed)(r,t).then(function(e){return e.slice(0,32)});case 11:return a=e.sent,i=n.crypto_sign_seed_keypair(a),e.abrupt("return",{mnemonic:r,passphrase:t,sk:V.b58cencode(i.privateKey,W.edsk),pk:V.b58cencode(i.publicKey,W.edpk),pkh:V.b58cencode(n.crypto_generichash(20,i.publicKey),W.tz1)});case 14:case"end":return e.stop()}},e,null,[[0,5]])}));return function(r,t){return e.apply(this,arguments)}}(),ye.sign=function(){var e=l()(p.a.mark(function e(r,t,n){var a,i,o,c,s,u,f,l=arguments;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=l.length>3&&void 0!==l[3]?l[3]:"",e.prev=1,e.next=4,U.a.ready;case 4:e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(1),new Error(e.t0);case 9:if(i=U.a,54!==t.length&&55!==t.length){e.next=21;break}return e.prev=11,e.next=14,ye.extractKeys(t,a);case 14:o=e.sent,t=o.sk,e.next=21;break;case 18:throw e.prev=18,e.t1=e.catch(11),new Error(e.t1);case 21:return c=V.hex2buf(r),void 0!==n&&(c=V.mergebuf(n,c)),s=i.crypto_sign_detached(i.crypto_generichash(32,c),V.b58cdecode(t,W.edsk),"uint8array"),u=V.b58cencode(s,W.edsig),f=r+V.buf2hex(s),e.abrupt("return",{bytes:r,sig:V.b58cencode(s,W.sig),prefixSig:u,sbytes:f});case 27:case"end":return e.stop()}},e,null,[[1,6],[11,18]])}));return function(r,t,n){return e.apply(this,arguments)}}(),ye.verify=function(){var e=l()(p.a.mark(function e(r,t,n){var a;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,U.a.ready;case 3:e.next=8;break;case 5:throw e.prev=5,e.t0=e.catch(0),new Error(e.t0);case 8:return a=U.a,e.abrupt("return",a.crypto_sign_verify_detached(t,V.hex2buf(r),V.b58cdecode(n,W.edpk)));case 10:case"end":return e.stop()}},e,null,[[0,5]])}));return function(r,t,n){return e.apply(this,arguments)}}();var ke=ye;t.d(r,"Key",function(){return $}),t.d(r,"crypto",function(){return ke}),t.d(r,"forge",function(){return re}),t.d(r,"utility",function(){return V}),t.d(r,"ledger",function(){return ge}),t.d(r,"prefix",function(){return W}),t.d(r,"watermark",function(){return Y}),t.d(r,"forgeMappings",function(){return J});r.default=be}])});