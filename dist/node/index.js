!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var r=t();for(var n in r)("object"==typeof exports?exports:e)[n]=r[n]}}(global,(function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=12)}([function(e,t){e.exports=require("typedarray-to-buffer")},function(e,t){e.exports=require("libsodium-wrappers")},function(e,t){e.exports=require("bignumber.js")},function(e,t){e.exports=require("elliptic")},function(e,t){e.exports=require("bs58check")},function(e,t){e.exports=require("pbkdf2")},function(e,t){e.exports=require("buffer/")},function(e,t){e.exports=require("@taquito/michelson-encoder")},function(e,t){e.exports=require("blake2b")},function(e,t){e.exports=require("@ledgerhq/hw-transport-node-hid")},function(e,t){e.exports=require("bip39")},function(e,t){e.exports=require("xhr2")},function(e,t,r){"use strict";r.r(t),r.d(t,"Sotez",(function(){return He})),r.d(t,"Key",(function(){return ue})),r.d(t,"crypto",(function(){return Ze})),r.d(t,"extractKeys",(function(){return Ge})),r.d(t,"generateKeys",(function(){return Ve})),r.d(t,"checkAddress",(function(){return Je})),r.d(t,"generateMnemonic",(function(){return Qe})),r.d(t,"sign",(function(){return Xe})),r.d(t,"verify",(function(){return We})),r.d(t,"address",(function(){return Se})),r.d(t,"decodeRawBytes",(function(){return ze})),r.d(t,"encodeRawBytes",(function(){return $e})),r.d(t,"forge",(function(){return qe})),r.d(t,"op",(function(){return Oe})),r.d(t,"endorsement",(function(){return Ue})),r.d(t,"seedNonceRevelation",(function(){return Be})),r.d(t,"doubleEndorsementEvidence",(function(){return Ce})),r.d(t,"doubleBakingEvidence",(function(){return Me})),r.d(t,"activateAccount",(function(){return Te})),r.d(t,"proposals",(function(){return je})),r.d(t,"ballot",(function(){return Ke})),r.d(t,"reveal",(function(){return Le})),r.d(t,"transaction",(function(){return Fe})),r.d(t,"origination",(function(){return Ie})),r.d(t,"delegation",(function(){return Ne})),r.d(t,"parameters",(function(){return Ae})),r.d(t,"publicKey",(function(){return Pe})),r.d(t,"publicKeyHash",(function(){return Ee})),r.d(t,"zarith",(function(){return xe})),r.d(t,"bool",(function(){return we})),r.d(t,"script",(function(){return ke})),r.d(t,"toBytesInt32",(function(){return ve})),r.d(t,"toBytesInt32Hex",(function(){return _e})),r.d(t,"utility",(function(){return ae})),r.d(t,"textEncode",(function(){return z})),r.d(t,"textDecode",(function(){return $})),r.d(t,"b582int",(function(){return R})),r.d(t,"totez",(function(){return H})),r.d(t,"mutez",(function(){return D})),r.d(t,"b58cencode",(function(){return Y})),r.d(t,"b58cdecode",(function(){return G})),r.d(t,"buf2hex",(function(){return Q})),r.d(t,"hex2buf",(function(){return J})),r.d(t,"hexNonce",(function(){return V})),r.d(t,"mergebuf",(function(){return X})),r.d(t,"sexp2mic",(function(){return Z})),r.d(t,"mic2arr",(function(){return ee})),r.d(t,"ml2mic",(function(){return te})),r.d(t,"ml2tzjson",(function(){return re})),r.d(t,"tzjson2arr",(function(){return ne})),r.d(t,"mlraw2json",(function(){return ie})),r.d(t,"mintotz",(function(){return se})),r.d(t,"tztomin",(function(){return oe})),r.d(t,"ledger",(function(){return I})),r.d(t,"getAddress",(function(){return K})),r.d(t,"signOperation",(function(){return L})),r.d(t,"getVersion",(function(){return F})),r.d(t,"constants",(function(){return T})),r.d(t,"prefix",(function(){return S})),r.d(t,"magicBytes",(function(){return x})),r.d(t,"forgeMappings",(function(){return C})),r.d(t,"protocols",(function(){return M}));var n=r(11),i=r.n(n);var s=r(1),o=r(5),a=r(3),c=r(0),u=r.n(c),h=r(9),l=r.n(h),p=r(4),d=r.n(p),g=r(8),f=r.n(g);function y(e){const t=[];return e.split("/").forEach(e=>{let r=parseInt(e,10);Number.isNaN(r)||(e.length>1&&"'"===e[e.length-1]&&(r+=2147483648),t.push(r))}),t}const m=e=>{switch(e){case 0:return Buffer.of(13,15,37,217);case 1:return Buffer.of(3,254,226,86);case 2:return Buffer.of(3,178,139,127);default:return Buffer.of(0)}},b=e=>{switch(e){case 0:return Buffer.of(6,161,159);case 1:return Buffer.of(6,161,161);case 2:return Buffer.of(6,161,164);default:return Buffer.of(0)}},v=(e,t)=>(e=((e,t)=>{switch(t){case 0:return(e=e.slice(0))[0]=t,e;case 1:case 2:return Buffer.concat([Buffer.of(t,2+(1&e[64])),e.slice(1,33)]);default:return Buffer.of(0)}})(e,t),{publicKey:_(e),address:w(e)}),_=e=>{const t=e[0],r=e.slice(1);return d.a.encode(Buffer.concat([m(t),r]))},w=e=>{const t=e[0],r=e.slice(1);let n=f()(20);return n.update(r),n.digest(n=Buffer.alloc(20)),d.a.encode(Buffer.concat([b(t),n]))};var k=function(e,t,r,n){return new(r||(r=Promise))((function(i,s){function o(e){try{c(n.next(e))}catch(e){s(e)}}function a(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,a)}c((n=n.apply(e,t||[])).next())}))};const A=0;class E{constructor(e){this.transport=e,e.decorateAppAPIMethods(this,["getAddress","signOperation","getVersion"],"XTZ")}getAddress(e,t=!1,r=A,n){return k(this,void 0,void 0,(function*(){n||(n=t?3:2);const i=r,s=y(e),o=Buffer.alloc(1+4*s.length);o[0]=s.length,s.forEach((e,t)=>{o.writeUInt32BE(e,1+4*t)});const a=yield this.transport.send(128,n,0,i,o),c=a[0],u=a.slice(1,1+c);return v(u,r)}))}sign(e,t,r=A,n){return k(this,void 0,void 0,(function*(){const i=y(e);let s=0;const o=Buffer.from(t,"hex"),a=[],c=Buffer.alloc(4*i.length+1);for(c[0]=i.length,i.forEach((e,t)=>{c.writeUInt32BE(e,1+4*t)}),a.push(c);s!==o.length;){const e=230;let t;t=s+e>=o.length?o.length-s:e;const r=Buffer.alloc(t);o.copy(r,0,s,s+t),a.push(r),s+=t}let u,h;for(let e=0;e<a.length;e++){const t=a[e];let i=1;0===e?i=0:e===a.length-1&&(i=129),u=yield this.transport.send(128,n,i,r,t)}if(r===A)h=u.slice(0,u.length-2).toString("hex");else{const e=Buffer.alloc(64);e.fill(0);const t=e.subarray(0,32),r=e.subarray(32,64);let n=0;const i=u.readUInt8(n++);if(49!==i&&48!==i)throw new Error("Cannot parse ledger response.");if(u.readUInt8(n++)+4!==u.length)throw new Error("Cannot parse ledger response.");if(2!==u.readUInt8(n++))throw new Error("Cannot parse ledger response.");let s=u.readUInt8(n++);if(s>32&&(n+=s-32,s=32),u.copy(t,32-s,n,n+s),n+=s,2!==u.readUInt8(n++))throw new Error("Cannot parse ledger response.");let o=u.readUInt8(n++);if(o>32&&(n+=o-32,o=32),u.copy(r,32-o,n,n+o),n+=o,n!==u.length-2)throw new Error("Cannot parse ledger response.");h=e.toString("hex")}return{signature:h}}))}signOperation(e,t,r=A){return this.sign(e,t,r,4)}signHash(e,t,r=A){return this.sign(e,t,r,5)}getVersion(){return k(this,void 0,void 0,(function*(){const[e,t,r,n]=yield this.transport.send(128,0,0,0,Buffer.alloc(0));return{major:t,minor:r,patch:n,bakingApp:1===e}}))}}const S={tz1:new Uint8Array([6,161,159]),tz2:new Uint8Array([6,161,161]),tz3:new Uint8Array([6,161,164]),KT:new Uint8Array([2,90,121]),edpk:new Uint8Array([13,15,37,217]),edsk2:new Uint8Array([13,15,58,7]),spsk:new Uint8Array([17,162,224,201]),p2sk:new Uint8Array([16,81,238,189]),sppk:new Uint8Array([3,254,226,86]),p2pk:new Uint8Array([3,178,139,127]),edesk:new Uint8Array([7,90,60,179,41]),edsk:new Uint8Array([43,246,78,7]),edsig:new Uint8Array([9,245,205,134,18]),spsig:new Uint8Array([13,115,101,19,63]),p2sig:new Uint8Array([54,240,44,52]),sig:new Uint8Array([4,130,43]),Net:new Uint8Array([87,82,0]),nce:new Uint8Array([69,220,169]),b:new Uint8Array([1,52]),o:new Uint8Array([5,116]),Lo:new Uint8Array([133,233]),LLo:new Uint8Array([29,159,109]),P:new Uint8Array([2,170]),Co:new Uint8Array([79,179]),id:new Uint8Array([153,103]),expr:new Uint8Array([13,44,64,27]),TZ:new Uint8Array([2,90,121])},x={block:new Uint8Array([1]),endorsement:new Uint8Array([2]),generic:new Uint8Array([3])},P={"00":"parameter","01":"storage","02":"code","03":"False","04":"Elt","05":"Left","06":"None","07":"Pair","08":"Right","09":"Some","0A":"True","0B":"Unit","0C":"PACK","0D":"UNPACK","0E":"BLAKE2B","0F":"SHA256",10:"SHA512",11:"ABS",12:"ADD",13:"AMOUNT",14:"AND",15:"BALANCE",16:"CAR",17:"CDR",18:"CHECK_SIGNATURE",19:"COMPARE","1A":"CONCAT","1B":"CONS","1C":"CREATE_ACCOUNT","1D":"CREATE_CONTRACT","1E":"IMPLICIT_ACCOUNT","1F":"DIP",20:"DROP",21:"DUP",22:"EDIV",23:"EMPTY_MAP",24:"EMPTY_SET",25:"EQ",26:"EXEC",27:"FAILWITH",28:"GE",29:"GET","2A":"GT","2B":"HASH_KEY","2C":"IF","2D":"IF_CONS","2E":"IF_LEFT","2F":"IF_NONE",30:"INT",31:"LAMBDA",32:"LE",33:"LEFT",34:"LOOP",35:"LSL",36:"LSR",37:"LT",38:"MAP",39:"MEM","3A":"MUL","3B":"NEG","3C":"NEQ","3D":"NIL","3E":"NONE","3F":"NOT",40:"NOW",41:"OR",42:"PAIR",43:"PUSH",44:"RIGHT",45:"SIZE",46:"SOME",47:"SOURCE",48:"SENDER",49:"SELF","4A":"STEPS_TO_QUOTA","4B":"SUB","4C":"SWAP","4D":"TRANSFER_TOKENS","4E":"SET_DELEGATE","4F":"UNIT",50:"UPDATE",51:"XOR",52:"ITER",53:"LOOP_LEFT",54:"ADDRESS",55:"CONTRACT",56:"ISNAT",57:"CAST",58:"RENAME",59:"bool","5A":"contract","5B":"int","5C":"key","5D":"key_hash","5E":"lambda","5F":"list",60:"map",61:"big_map",62:"nat",63:"option",64:"or",65:"pair",66:"set",67:"signature",68:"string",69:"bytes","6A":"mutez","6B":"timestamp","6C":"unit","6D":"operation","6E":"address","6F":"SLICE",70:"DIG",71:"DUG",72:"EMPTY_BIG_MAP",73:"APPLY",74:"chain_id",75:"CHAIN_ID"},O=(()=>{const e={};return Object.keys(P).forEach(t=>{e[P[t]]=t}),e})(),U={"00":"default","01":"root","02":"do","03":"set_delegate","04":"remove_delegate"},B=(()=>{const e={};return Object.keys(U).forEach(t=>{e[U[t]]=t}),e})(),C={opMapping:P,opMappingReverse:O,primMapping:{"00":"int","01":"string","02":"seq","03":{name:"prim",len:0,annots:!1},"04":{name:"prim",len:0,annots:!0},"05":{name:"prim",len:1,annots:!1},"06":{name:"prim",len:1,annots:!0},"07":{name:"prim",len:2,annots:!1},"08":{name:"prim",len:2,annots:!0},"09":{name:"prim",len:3,annots:!0},"0A":"bytes"},primMappingReverse:{0:{false:"03",true:"04"},1:{false:"05",true:"06"},2:{false:"07",true:"08"},3:{true:"09"}},forgeOpTags:{"001":{endorsement:0,seed_nonce_revelation:1,double_endorsement_evidence:2,double_baking_evidence:3,activate_account:4,proposals:5,ballot:6,reveal:7,transaction:8,origination:9,delegation:10},"005":{endorsement:0,seed_nonce_revelation:1,double_endorsement_evidence:2,double_baking_evidence:3,activate_account:4,proposals:5,ballot:6,reveal:107,transaction:108,origination:109,delegation:110}},entrypointMapping:U,entrypointMappingReverse:B},M={"001":"PtCJ7pwoxe8JasnHY8YonnLYjcVHmhiARPJvqcC6VfHT5s8k8sY","002":"PsYLVpVvgbLhAhoqAkMFUo6gudkJ9weNXhUYCiLDzcUpFpkk8Wt","003":"PsddFKi32cMJ2qPjf43Qv5GDWLDPZb3T3bF6fLKiF5HtvHNU7aP","004":"Pt24m4xiPbLDhVgVfABUjirbmda3yohdN82Sp9FeuAXJ4eV9otd","005a":"PsBABY5HQTSkA4297zNHfsZNKtxULfL18y95qb3m53QJiXGmrbU","005":"PsBabyM1eUXZseaJdmXFApDSBqj8YBfwELoxZHHW77EMcAbbwAS","006":"PsCARTHAGazKbHtnKfLzQg3kms52kSRpgnDY982a9oYsSXRLQEb"};var T={prefix:S,magicBytes:x,forgeMappings:C,protocols:M},j=function(e,t,r,n){return new(r||(r=Promise))((function(i,s){function o(e){try{c(n.next(e))}catch(e){s(e)}}function a(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,a)}c((n=n.apply(e,t||[])).next())}))};const K=({path:e="44'/1729'/0'/0'",displayConfirm:t=!0,curve:r=0}={})=>j(void 0,void 0,void 0,(function*(){const n=yield l.a.create(),i=new E(n);let s;try{s=yield i.getAddress(e,t,r)}catch(e){return n.close(),e}return n.close(),s})),L=({path:e="44'/1729'/0'/0'",rawTxHex:t,curve:r=0,magicBytes:n=x.generic})=>j(void 0,void 0,void 0,(function*(){const i=yield l.a.create(),s=new E(i);let o;try{const i=("00"+n).slice(-2);({signature:o}=yield s.signOperation(e,`${i}${t}`,r))}catch(e){return i.close(),e}return i.close(),o})),F=()=>j(void 0,void 0,void 0,(function*(){const e=yield l.a.create(),t=new E(e);let r;try{r=yield t.getVersion()}catch(t){return e.close(),t}return e.close(),r}));var I={getAddress:K,signOperation:L,getVersion:F},N=r(2),q=r(6);const z=e=>new Uint8Array(q.Buffer.from(e,"utf8")),$=e=>q.Buffer.from(e).toString("utf8"),R=e=>{let t=new N.BigNumber(0);const r="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";for(let n=0;n<e.length;n++)t=t.plus(new N.BigNumber(r.indexOf(e[e.length-1-n])).multipliedBy(new N.BigNumber(r.length).exponentiatedBy(n)));return t.toString(16)},H=e=>{if("number"==typeof e)return e/1e6;if("string"==typeof e)return parseInt(e,10)/1e6;throw new TypeError('Invalid parameter for "mutez" provided.')},D=e=>new N.BigNumber(new N.BigNumber(e).toFixed(6)).multipliedBy(1e6).toString(),Y=(e,t)=>{const r=new Uint8Array(t.length+e.length);return r.set(t),r.set(e,t.length),d.a.encode(q.Buffer.from(r,"hex"))},G=(e,t)=>d.a.decode(e).slice(t.length),Q=e=>{const t=new Uint8Array(e),r=[];return t.forEach(e=>{const t=("00"+e.toString(16)).slice(-2);r.push(t)}),r.join("")},J=e=>new Uint8Array(e.match(/[\da-f]{2}/gi).map(e=>parseInt(e,16))),V=e=>{let t="";for(;e--;)t+="0123456789abcedf"[16*Math.random()|0];return t},X=(e,t)=>{const r=new Uint8Array(e.length+t.length);return r.set(e),r.set(t,e.length),r},W=e=>{let t=f()(32);return t.update(J(e)),t.digest(t=q.Buffer.alloc(32)),Y(t,S.expr)},Z=function e(t){"("===(t=t.replace(/(?:@[a-z_]+)|(?:#.*$)/gm,"").replace(/\s+/g," ").trim()).charAt(0)&&(t=t.slice(1,-1));let r=0,n=!1,i=!1;const s={prim:"",args:[]};let o="";for(let a=0;a<t.length;a++)if(i)o+=t[a],i=!1;else if(a===t.length-1&&!1===n||" "===t[a]&&0===r&&!1===n){if(a===t.length-1&&(o+=t[a]),o){if(o===parseInt(o,10).toString()){if(!s.prim)return{int:o};s.args.push({int:o})}else if("0"===o[0]&&"x"===o[1]){if(o=o.substring(2),!s.prim)return{bytes:o};s.args.push({bytes:o})}else s.prim?s.args.push(e(o)):s.prim=o;o=""}}else if('"'===t[a]&&n){if(n=!1,!s.prim)return{string:o};s.args.push({string:o}),o=""}else'"'!==t[a]||n||0!==r?("\\"===t[a]?i=!0:"("===t[a]?r++:")"===t[a]&&r--,o+=t[a]):n=!0;return s},ee=function e(t){let r=[];if(Object.prototype.hasOwnProperty.call(t,"prim"))"Pair"===t.prim?(r.push(e(t.args[0])),r=r.concat(e(t.args[1]))):"Elt"===t.prim?r={key:e(t.args[0]),val:e(t.args[1])}:"True"===t.prim?r=!0:"False"===t.prim&&(r=!1);else if(Array.isArray(t)){const n=t.length;for(let i=0;i<n;i++){const n=e(t[i]);void 0!==n.key?(Array.isArray(r)&&(r={keys:[],vals:[]}),r.keys.push(n.key),r.vals.push(n.val)):r.push(n)}}else r=Object.prototype.hasOwnProperty.call(t,"string")?t.string:Object.prototype.hasOwnProperty.call(t,"int")?parseInt(t.int,10):t;return r},te=function e(t){const r=[];let n=!1,i="",s="",o=0,a=0,c=!1,u=!1;for(let h=0;h<t.length;h++){if("}"!==s&&";"!==s||(s=""),n){if("}"===t[h]?a--:"{"===t[h]&&a++,0===a){const t=e(s);r.push({prim:i.trim(),args:[t]}),s="",a=0,n=!1}}else{if("{"===t[h]){a++,i=s,s="",n=!0;continue}if(u){s+=t[h],u=!1;continue}if(h===t.length-1&&!1===c||";"===t[h]&&0===o&&!1===c){if(h===t.length-1&&(s+=t[h]),""===s.trim()||"}"===s.trim()||";"===s.trim()){s="";continue}r.push(Z(s)),s="";continue}'"'===t[h]&&c?c=!1:'"'!==t[h]||c?"\\"===t[h]?u=!0:"("===t[h]?o++:")"===t[h]&&o--:c=!0}s+=t[h]}return r},re=Z,ne=ee,ie=te,se=H,oe=D;var ae={textEncode:z,textDecode:$,b582int:R,totez:H,mutez:D,b58cencode:Y,b58cdecode:G,buf2hex:Q,hex2buf:J,hexNonce:V,mergebuf:X,encodeExpr:W,sexp2mic:Z,mic2arr:ee,ml2mic:te,ml2tzjson:re,tzjson2arr:ne,mlraw2json:ie,mintotz:se,tztomin:oe},ce=function(e,t,r,n){return new(r||(r=Promise))((function(i,s){function o(e){try{c(n.next(e))}catch(e){s(e)}}function a(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,a)}c((n=n.apply(e,t||[])).next())}))};class ue{constructor({key:e,passphrase:t,email:r,ledgerPath:n="44'/1729'/0'/0'",ledgerCurve:i=0}={}){this.publicKey=()=>Y(this._publicKey,S[this._curve+"pk"]),this.secretKey=()=>{if(!this._secretKey)throw new Error("Secret key not known.");let e=this._secretKey;if("ed"===this._curve){const{privateKey:t}=s.crypto_sign_seed_keypair(e.slice(0,32));e=u()(t)}return Y(e,S[this._curve+"sk"])},this.publicKeyHash=()=>{const e={ed:S.tz1,sp:S.tz2,p2:S.tz3}[this._curve];return Y(s.crypto_generichash(20,this._publicKey),e)},this.initialize=({key:e,passphrase:t,email:r},n)=>ce(this,void 0,void 0,(function*(){if(yield s.ready,!this._isLedger&&e||({publicKey:e}=yield I.getAddress({path:this._ledgerPath,displayConfirm:!0,curve:this._ledgerCurve})),r){if(!t)throw new Error("Fundraiser key provided without a passphrase.");const i=$(z(`${r}${t}`)).normalize("NFKD"),a=o.pbkdf2Sync(e,"mnemonic"+i,2048,64,"sha512"),{publicKey:c,privateKey:h}=s.crypto_sign_seed_keypair(a.slice(0,32));return this._publicKey=u()(c),this._secretKey=u()(h),this._curve="ed",this._isSecret=!0,void n()}if(this._curve=e.substring(0,2),!["sp","p2","ed"].includes(this._curve))throw new Error("Invalid prefix for a key encoding.");if(![54,55,88,98].includes(e.length))throw new Error("Invalid length for a key encoding");const i="e"===e.substring(2,3),c=i?e.substring(3,5):e.substring(2,4);if(!["pk","sk"].includes(c))throw new Error("Invalid prefix for a key encoding.");let h;if(this._isSecret="sk"===c,h=this._isSecret?G(e,S[`${this._curve}${i?"e":""}sk`]):G(e,S[this._curve+"pk"]),i){if(!t)throw new Error("Encrypted key provided without a passphrase.");const e=u()(h.slice(0,8)),r=h.slice(8),n=o.pbkdf2Sync(t,e,32768,32,"sha512");h=s.crypto_secretbox_open_easy(r,new Uint8Array(24),n)}if(this._isSecret)if(this._secretKey=u()(h),"ed"===this._curve)if(64===h.length)this._publicKey=u()(h.slice(32));else{const{publicKey:e,privateKey:t}=s.crypto_sign_seed_keypair(h,"uint8array");this._publicKey=u()(e),this._secretKey=u()(t)}else if("sp"===this._curve){const e=new a.ec("secp256k1").keyFromPrivate(h),t=e.getPublic().getY().toArray()[31]%2?3:2,r=new Array(32).fill(0);this._publicKey=u()(new Uint8Array([t].concat(r.concat(e.getPublic().getX().toArray()).slice(-32))))}else{if("p2"!==this._curve)throw new Error("Invalid key");{const e=new a.ec("p256").keyFromPrivate(h),t=e.getPublic().getY().toArray()[31]%2?3:2,r=new Array(32).fill(0);this._publicKey=u()(new Uint8Array([t].concat(r.concat(e.getPublic().getX().toArray()).slice(-32))))}}else this._publicKey=u()(h),this._secretKey=void 0;n()})),this.sign=(e,t)=>ce(this,void 0,void 0,(function*(){if(this._isLedger){const r=yield I.signOperation({path:this._ledgerPath,rawTxHex:e,curve:this._ledgerCurve,magicBytes:t}),n=J(r),i=e+r;return{bytes:e,magicBytes:t?Q(u()(t)):"",sig:Y(n,S.sig),prefixSig:Y(n,S[this._curve+"sig"]),sbytes:i}}let r=J(e);void 0!==t&&(r=X(t,r));const n=u()(s.crypto_generichash(32,r));if(!this._secretKey)throw new Error("Cannot sign operations without a secret key.");if("ed"===this._curve){const r=s.crypto_sign_detached(n,this._secretKey),i=u()(r),o=e+Q(i);return{bytes:e,magicBytes:t?Q(u()(t)):"",sig:Y(r,S.sig),prefixSig:Y(r,S.edsig),sbytes:o}}if("sp"===this._curve){const r=new a.ec("secp256k1").keyFromPrivate(this._secretKey).sign(n,{canonical:!0}),i=new Uint8Array(r.r.toArray(void 0,32).concat(r.s.toArray(void 0,32))),s=u()(i),o=e+Q(s);return{bytes:e,magicBytes:t?Q(u()(t)):"",sig:Y(i,S.sig),prefixSig:Y(i,S.spsig),sbytes:o}}if("p2"===this._curve){const r=new a.ec("p256").keyFromPrivate(this._secretKey).sign(n,{canonical:!0}),i=new Uint8Array(r.r.toArray(void 0,32).concat(r.s.toArray(void 0,32))),s=u()(i),o=e+Q(s);return{bytes:e,magicBytes:t?Q(u()(t)):"",sig:Y(i,S.sig),prefixSig:Y(i,S.p2sig),sbytes:o}}throw new Error("Provided curve not supported")})),this.verify=(e,t,r=this.publicKey())=>{if(!r)throw new Error("Cannot verify without a public key");const n=r.substring(0,2),i=u()(G(r,S[n+"pk"]));if("sig"!==t.substring(0,3)&&n!==t.substring(0,2))throw new Error("Signature and public key curves mismatch.");const o=s.crypto_generichash(32,J(e));let c;if("sig"===t.substring(0,3))c=G(t,S.sig);else{if(t.substring(0,5)!==n+"sig")throw new Error("Invalid signature provided: "+t);c=G(t,S[n+"sig"])}if("ed"!==n){if("sp"===n){const e=new a.ec("secp256k1").keyFromPublic(i),t=Q(u()(c)).match(/([a-f\d]{64})/gi);if(t)try{const[r,n]=t;return e.verify(o,{r,s:n})}catch(e){return!1}return!1}if("p2"===n){const e=new a.ec("p256").keyFromPublic(i),t=Q(u()(c)).match(/([a-f\d]{64})/gi);if(t)try{const[r,n]=t;return e.verify(o,{r,s:n})}catch(e){return!1}return!1}throw new Error(`Curve '${n}' not supported`)}try{return s.crypto_sign_verify_detached(c,o,i)}catch(e){return!1}},this._isLedger=!e,this._ledgerPath=n,this._ledgerCurve=i,this.ready=new Promise(n=>{this.initialize({key:e,passphrase:t,email:r},n)})}get curve(){return this._curve}get isLedger(){return this._isLedger}set isLedger(e){this._isLedger=e}get ledgerPath(){return this._ledgerPath}set ledgerPath(e){this._ledgerPath=e}get ledgerCurve(){return this._ledgerCurve}set ledgerCurve(e){this._ledgerCurve=e}}var he=r(7),le=function(e,t,r,n){return new(r||(r=Promise))((function(i,s){function o(e){try{c(n.next(e))}catch(e){s(e)}}function a(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,a)}c((n=n.apply(e,t||[])).next())}))};class pe extends Error{constructor(e,t,r){super(`${e} Received ${r.length} arguments while expecting one of the follow signatures (${JSON.stringify(t)})`),this.smartContractMethodName=e,this.sigs=t,this.args=r,this.name="Invalid parameters error"}}class de{constructor(e,t,r){this.id=e,this.schema=t,this.client=r}get(e){return le(this,void 0,void 0,(function*(){const t=this.schema.EncodeBigMapKey(e),{packed:r}=yield this.client.packData(t.key,t.type),n=W(r),i=yield this.client.query(`/chains/${this.client.chain}/blocks/head/context/big_maps/${this.id.toString()}/${n}`);return this.schema.ExecuteOnBigMapValue(i,ge(this.client))}))}}const ge=e=>({big_map:(t,r)=>{if(!t||!("int"in t)||void 0===t.int)return{};const n=new he.Schema(r);return new de(new N.BigNumber(t.int),n,e)}});class fe{constructor(e,t){this.client=e,this.address=t,this.methods={},this._init=e=>le(this,void 0,void 0,(function*(){const t=[];t.push(this.client.query(`/chains/${this.client.chain}/blocks/head/context/contracts/${this.address}`)),t.push(this.client.query(`/chains/${this.client.chain}/blocks/head/context/contracts/${this.address}/entrypoints`));const[{script:r},{entrypoints:n}]=yield Promise.all(t);return this.schema=he.Schema.fromRPCResponse({script:r}),this.parameterSchema=he.ParameterSchema.fromRPCResponse({script:r}),this.entrypoints=n,this._initializeMethods(e,this.parameterSchema,this.entrypoints),!0})),this._initializeMethods=(e,t,r)=>{this.methods={};const n=Object.keys(r);if(t.isMultipleEntryPoint){n.forEach(t=>{this.methods[t]=(...n)=>{const i=new he.ParameterSchema(r[t]);return ye(n,i,t),new me(this.client,e,i,t,n)}});Object.keys(t.ExtractSchema()).filter(e=>-1===Object.keys(r).indexOf(e)).forEach(r=>{this.methods[r]=(...n)=>(ye([r,...n],t,r),new me(this.client,e,t,r,n,!1,!0))})}else{const r=t,n=(...n)=>(ye(n,t,"default"),new me(this.client,e,r,"default",n,!1));this.methods.default=n}},this.storage=()=>le(this,void 0,void 0,(function*(){yield this.loaded;const e=yield this.client.query(`/chains/${this.client.chain}/blocks/head/context/contracts/${this.address}/storage`);return this.schema.Execute(e,ge(this.client))})),this.balance=()=>le(this,void 0,void 0,(function*(){return yield this.loaded,this.client.query(`/chains/${this.client.chain}/blocks/head/context/contracts/${this.address}/balance`)})),this.loaded=this._init(t)}}const ye=(e,t,r)=>{const n=t.ExtractSignatures();if(!n.find(t=>t.length===e.length))throw new pe(r,n,e)};class me{constructor(e,t,r,n,i,s=!0,o=!1){this.client=e,this.address=t,this.parameterSchema=r,this.name=n,this.args=i,this.isMultipleEntrypoint=s,this.isAnonymous=o}get schema(){return this.isAnonymous?this.parameterSchema.ExtractSchema()[this.name]:this.parameterSchema.ExtractSchema()}send(e={}){return this.client.transfer(this.toTransferParams(e))}toTransferParams({fee:e,gasLimit:t,storageLimit:r,amount:n=0}={}){return{to:this.address,amount:n,fee:e,gasLimit:t,storageLimit:r,parameters:{entrypoint:this.isMultipleEntrypoint?this.name:"default",value:this.isAnonymous?this.parameterSchema.Encode(this.name,...this.args):this.parameterSchema.Encode(...this.args)}}}}var be=function(e,t,r,n){return new(r||(r=Promise))((function(i,s){function o(e){try{c(n.next(e))}catch(e){s(e)}}function a(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,a)}c((n=n.apply(e,t||[])).next())}))};const ve=e=>{e=parseInt(e,10);return new Uint8Array([(4278190080&e)>>24,(16711680&e)>>16,(65280&e)>>8,255&e]).buffer},_e=e=>{const t=u()(ve(e));return Q(t)},we=e=>e?"ff":"00",ke=e=>{const t=$e(e.code).toLowerCase(),r=$e(e.storage).toLowerCase();return _e(t.length/2)+t+_e(r.length/2)+r},Ae=(e,t)=>{const r=e=>{const t=[];t.push(we(!0));const r=$e(e).toLowerCase();return t.push(_e(r.length/2)+r),t.join("")},n=e=>{const t=[],r="default"===e.entrypoint;if(t.push(r?"00":"FF"),!r){const r=$e(e.value).toLowerCase();if(C.entrypointMappingReverse[e.entrypoint])t.push(C.entrypointMappingReverse[e.entrypoint]);else{const r=$e({string:e.entrypoint}).toLowerCase();t.push("FF"),t.push(r.slice(8))}t.push((r.length/2).toString(16).padStart(8,"0")),t.push(r)}return t.join("")},i={[""+M["001"]]:r,[""+M["002"]]:r,[""+M["003"]]:r,[""+M["004"]]:r,[""+M["005a"]]:n,[""+M["005"]]:n,[""+M["006"]]:n};if(!i[t])throw new Error("Unrecognized protocol: "+t);return i[t](e)},Ee=e=>{const t=["0"+(parseInt(e.substr(2,1),10)-1)],r=u()(G(e,S[e.substring(0,3)]));return t.push(Q(r)),t.join("")},Se=(e,t="")=>{const r=[],n={[""+M["001"]]:!0,[""+M["002"]]:!0,[""+M["003"]]:!0,[""+M["004"]]:!0},i=e=>!t||n[t]?"K"===e.substring(0,1)?"01":"00":"";if("K"===e.substring(0,1)){r.push(i(e));const t=u()(G(e,S.KT));r.push(Q(t)),r.push("00")}else r.push(i(e)),r.push(Ee(e));return r.join("")},xe=e=>{const t=[];let r=new N.BigNumber(e,10);if(r.isNaN())throw new TypeError("Error forging zarith "+e);for(;;){if(r.lt(128)){r.lt(16)&&t.push("0"),t.push(r.toString(16));break}{let e=r.mod(128);r=r.minus(e),r=r.dividedBy(128),e=e.plus(128),t.push(e.toString(16))}}return t.join("")},Pe=e=>{const t=[];switch(e.substring(0,2)){case"ed":t.push("00");break;case"sp":t.push("01");break;case"p2":t.push("02")}const r=u()(G(e,S[e.substring(0,4)]));return t.push(Q(r)),t.join("")},Oe=(e,t)=>{const r=e=>u()(new Uint8Array([C.forgeOpTags["001"][e]])),n=e=>u()(new Uint8Array([C.forgeOpTags["005"][e]])),i={[""+M["001"]]:r,[""+M["002"]]:r,[""+M["003"]]:r,[""+M["004"]]:r,[""+M["005a"]]:n,[""+M["005"]]:n,[""+M["006"]]:n};if(!i[t])throw new Error("Unrecognized protocol: "+t);const s=[],o=i[t](e.kind);return s.push(Q(o)),"endorsement"===e.kind?s.push(Ue(e)):"seed_nonce_revelation"===e.kind?s.push(Be(e)):"double_endorsement_evidence"===e.kind?s.push(Ce()):"double_baking_evidence"===e.kind?s.push(Me()):"activate_account"===e.kind?s.push(Te(e)):"proposals"===e.kind?s.push(je()):"ballot"===e.kind?s.push(Ke(e)):"reveal"===e.kind?s.push(Le(e,t)):"transaction"===e.kind?s.push(Fe(e,t)):"origination"===e.kind?s.push(Ie(e,t)):"delegation"===e.kind&&s.push(Ne(e,t)),s.join("")},Ue=e=>{const t=u()(ve(e.level));return Q(t)},Be=e=>{const t=[],r=u()(ve(e.level));return t.push(Q(r)),t.push(e.nonce),t.join("")},Ce=()=>{throw new Error("Double endorse forging is not complete")},Me=()=>{throw new Error("Double bake forging is not complete")},Te=e=>{const t=[],r=u()(G(e.pkh,S.tz1));return t.push(Q(r)),t.push(e.secret),t.join("")},je=()=>{throw new Error("Proposal forging is not complete")},Ke=e=>{const t=[];t.push(Ee(e.source));const r=u()(ve(e.period));t.push(Q(r));const n=u()(G(e.proposal,S.P));let i;return t.push(Q(n)),i="yay"===e.ballot||"yea"===e.ballot?"00":"nay"===e.ballot?"01":"02",t.push(i),t.join("")},Le=(e,t)=>{const r=[];return r.push(Se(e.source,t)),r.push(xe(e.fee)),r.push(xe(e.counter)),r.push(xe(e.gas_limit)),r.push(xe(e.storage_limit)),r.push(Pe(e.public_key)),r.join("")},Fe=(e,t)=>{const r=[];return r.push(Se(e.source,t)),r.push(xe(e.fee)),r.push(xe(e.counter)),r.push(xe(e.gas_limit)),r.push(xe(e.storage_limit)),r.push(xe(e.amount)),r.push(Se(e.destination)),e.parameters?r.push(Ae(e.parameters,t)):r.push(we(!1)),r.join("")},Ie=(e,t)=>{const r=(e,t)=>(t.push(Ee(e.manager_pubkey)),t.push(xe(e.balance)),t.push(we(e.spendable)),t.push(we(e.delegatable)),e.delegate?(t.push(we(!0)),t.push(Ee(e.delegate))):t.push(we(!1)),e.script?(t.push(we(!0)),t.push(ke(e.script))):t.push(we(!1)),t.join("")),n=(e,t)=>(t.push(xe(e.balance)),e.delegate?(t.push(we(!0)),t.push(Ee(e.delegate))):t.push(we(!1)),t.push(ke(e.script)),t.join("")),i={[""+M["001"]]:r,[""+M["002"]]:r,[""+M["003"]]:r,[""+M["004"]]:r,[""+M["005a"]]:n,[""+M["005"]]:n,[""+M["006"]]:n},s=[];return s.push(Se(e.source,t)),s.push(xe(e.fee)),s.push(xe(e.counter)),s.push(xe(e.gas_limit)),s.push(xe(e.storage_limit)),i[t](e,s)},Ne=(e,t)=>{const r=[];return r.push(Se(e.source,t)),r.push(xe(e.fee)),r.push(xe(e.counter)),r.push(xe(e.gas_limit)),r.push(xe(e.storage_limit)),e.delegate?(r.push(we(!0)),r.push(Ee(e.delegate))):r.push(we(!1)),r.join("")},qe=(e,t,r)=>be(void 0,void 0,void 0,(function*(){if(!e.contents)throw new Error("No operation contents provided.");if(!e.branch)throw new Error("No operation branch provided.");const n=u()(G(e.branch,S.b)),i=[Q(n)];return e.contents.forEach(e=>{i.push(Oe(e,r))}),{opbytes:i.join(""),opOb:e,counter:t}})),ze=e=>{e=e.toUpperCase();let t=0;const r=r=>{const n=e.slice(t,t+r);return t+=r,n},n=()=>{const e=r(2),i=C.primMapping[e];if(i instanceof Object){const e={prim:C.opMapping[r(2)],args:[...Array(i.len)].map(()=>n()),annots:void 0};if(i.len||delete e.args,i.annots){const t=2*parseInt(r(8),16),n=r(t).match(/[\dA-F]{2}/g);if(n){const t=new Uint8Array(n.map(e=>parseInt(e,16))),r=$(t);e.annots=r.split(" ")}}else delete e.annots;return e}if("0A"===e){const e=r(8),t=2*parseInt(e,16);return{bytes:r(t)}}if("01"===e){const e=r(8),t=2*parseInt(e,16),n=r(t).match(/[\dA-F]{2}/g);if(n instanceof Array){const e=new Uint8Array(n.map(e=>parseInt(e,16)));return{string:$(e)}}throw new Error("Input bytes error")}if("00"===e){const e=parseInt(r(2),16).toString(2).padStart(8,"0"),t=[e.slice(2)];let n="1"===e[0];for(;n;){const e=parseInt(r(2),16).toString(2).padStart(8,"0");t.push(e.slice(1)),n="1"===e[0]}return{int:new N.BigNumber(t.reverse().join(""),2).toString()}}if("02"===e){const e=r(8),i=2*parseInt(e,16),s=t+i,o=[];for(;s>t;)o.push(n());return o}throw new Error(`Invalid raw bytes: Byte:${e} Index:${t}`)};return n()},$e=e=>{const t=e=>{const r=[];if(e instanceof Array){r.push("02");const n=e.map(e=>t(e)).join(""),i=n.length/2;r.push(i.toString(16).padStart(8,"0")),r.push(n)}else if(e instanceof Object)if("prim"in e){const n=e.args?e.args.length:0;if(r.push(C.primMappingReverse[n][""+!!e.annots]),r.push(C.opMappingReverse[e.prim]),e.args&&e.args.forEach(e=>r.push(t(e))),e.annots){const t=e.annots.map(e=>{const t=u()(z(e));return Q(t)}).join("20");r.push((t.length/2).toString(16).padStart(8,"0")),r.push(t)}}else if("bytes"in e){const t=e.bytes.length/2;r.push("0A"),r.push(t.toString(16).padStart(8,"0")),r.push(e.bytes)}else if("int"in e){const t=new N.BigNumber(e.int,10),n="-"===t.toString(2)[0]?"1":"0",i=t.toString(2).replace("-",""),s=i.length<=6?6:(i.length-6)%7?i.length+7-(i.length-6)%7:i.length,o=(i.padStart(s,"0").match(/\d{6,7}/g)||[]).reverse();o[0]=n+o[0];const a=o.map((e,t)=>parseInt((t===o.length-1?"0":"1")+e,2).toString(16).padStart(2,"0")).join("");r.push("00"),r.push(a)}else if("string"in e){const t=z(e.string),n=[].slice.call(t).map(e=>e.toString(16).padStart(2,"0")).join(""),i=t.length;r.push("01"),r.push(i.toString(16).padStart(8,"0")),r.push(n)}return r.join("")};return t(e).toUpperCase()};var Re=function(e,t,r,n){return new(r||(r=Promise))((function(i,s){function o(e){try{c(n.next(e))}catch(e){s(e)}}function a(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,a)}c((n=n.apply(e,t||[])).next())}))};class He extends class{constructor(e,t,r=!1){this.query=(e,t,r)=>(void 0===t?void 0===r?r="GET":t={}:void 0===r&&(r="POST"),new Promise((n,s)=>{try{const o=new i.a;o.open(r,this.provider+e,!0),o.onload=()=>{if(this._debugMode&&console.log("Node call:",e,t),200===o.status)if(o.responseText){let t=JSON.parse(o.responseText);this._debugMode&&console.log("Node response:",e,t),t&&void 0!==t.error?s(t.error):(t&&void 0!==t.ok&&(t=t.ok),n(t))}else s("Empty response returned");else o.responseText?s(o.responseText):s(o.statusText)},o.onerror=()=>{s(o.statusText)},"POST"===r?(o.setRequestHeader("Content-Type","application/json"),o.send(JSON.stringify(t))):o.send()}catch(e){s(e)}})),this._provider=e,this._chain=t,this._debugMode=r}get provider(){return this._provider}set provider(e){this._provider=e}get chain(){return this._chain}set chain(e){this._chain=e}get debugMode(){return this._debugMode}set debugMode(e){this._debugMode=e}setProvider(e,t=this.chain){this._provider=e,this._chain=t}}{constructor(e="http://127.0.0.1:8732",t="main",r={}){super(e,t,r.debugMode),this.importKey=(e,t,r)=>Re(this,void 0,void 0,(function*(){this.key=new ue({key:e,passphrase:t,email:r}),yield this.key.ready})),this.importLedger=(e="44'/1729'/0'/0'",t=0)=>Re(this,void 0,void 0,(function*(){this.key=new ue({ledgerPath:e,ledgerCurve:t}),yield this.key.ready})),this.account=({balance:e,spendable:t,delegatable:r,delegate:n,fee:i=this.defaultFee,gasLimit:s=10600,storageLimit:o=257})=>Re(this,void 0,void 0,(function*(){const a={};void 0!==t&&(a.spendable=t),void 0!==r&&(a.delegatable=r),n&&(a.delegate=n);const c=[Object.assign({kind:"origination",balance:this.useMutez?e:D(e),fee:i,gas_limit:s,storage_limit:o,manager_pubkey:this.key.publicKeyHash()},a)];return this.sendOperation({operation:c})})),this.getBalance=e=>this.query(`/chains/${this.chain}/blocks/head/context/contracts/${e}/balance`),this.getDelegate=e=>this.query(`/chains/${this.chain}/blocks/head/context/contracts/${e}/delegate`).then(e=>e||!1),this.getManager=e=>this.query(`/chains/${this.chain}/blocks/head/context/contracts/${e}/manager_key`),this.getCounter=e=>this.query(`/chains/${this.chain}/blocks/head/context/contracts/${e}/counter`),this.getBaker=e=>this.query(`/chains/${this.chain}/blocks/head/context/delegates/${e}`),this.getHeader=()=>this.query(`/chains/${this.chain}/blocks/head/header`),this.getHeadMetadata=()=>this.query(`/chains/${this.chain}/blocks/head/metadata`),this.getHead=()=>this.query(`/chains/${this.chain}/blocks/head`),this.getHeadHash=()=>this.query(`/chains/${this.chain}/blocks/head/hash`),this.getBallotList=()=>this.query(`/chains/${this.chain}/blocks/head/votes/ballot_list`),this.getProposals=()=>this.query(`/chains/${this.chain}/blocks/head/votes/proposals`),this.getBallots=()=>this.query(`/chains/${this.chain}/blocks/head/votes/ballots`),this.getListings=()=>this.query(`/chains/${this.chain}/blocks/head/votes/listings`),this.getCurrentProposal=()=>this.query(`/chains/${this.chain}/blocks/head/votes/current_proposal`),this.getCurrentPeriod=()=>this.query(`/chains/${this.chain}/blocks/head/votes/current_period_kind`),this.getCurrentQuorum=()=>this.query(`/chains/${this.chain}/blocks/head/votes/current_quorum`),this.awaitOperation=(e,t=10,r=180)=>{if(r<=0)throw new Error("Timeout must be more than 0");if(t<=0)throw new Error("Interval must be more than 0");const n=Math.ceil(r/t)+1;let i=0,s=!1;const o=t=>{t.hash===e&&(s=!0)};return new Promise((e,r)=>{const a=()=>this.getHead().then(c=>{i++;for(let e=3;e>=0;e--)c.operations[e].forEach(o);s?e(c.hash):i>=n?r(new Error("Timeout")):setTimeout(a,1e3*t)});a()})},this.call=(e,t)=>this.query(e,t),this.prepareOperation=({operation:e,source:t,skipCounter:r=!1})=>{let n;const i={},s=[];let o,a=!1,c=[];s.push(this.getHeader()),s.push(this.getHeadMetadata()),c=Array.isArray(e)?[...e]:[e];const u=t||this.key.publicKeyHash();for(let e=0;e<c.length;e++)if(["transaction","origination","delegation"].includes(c[e].kind)){a=!0,s.push(this.getManager(u)),s.push(this.getCounter(u));break}return Promise.all(s).then(([e,t,s,h])=>Re(this,void 0,void 0,(function*(){if(o=e,a){if(!this.getManagerKey(s,t.protocol)){const e={kind:"reveal",fee:1420,public_key:this.key.publicKey(),source:u,gas_limit:10600,storage_limit:300};c.unshift(e)}n=parseInt(h,10),(!this._counters[u]||this._counters[u]<n)&&(this._counters[u]=n)}i.branch=o.hash,i.contents=(e=>{let n=this._counters[u];return e.map(e=>{const i=Object.assign({},e);return["proposals","ballot","transaction","origination","delegation"].includes(e.kind)&&void 0===e.source&&(i.source=u),["reveal","transaction","origination","delegation"].includes(e.kind)&&(void 0===e.fee?i.fee="0":i.fee=""+e.fee,void 0===e.gas_limit?i.gas_limit="0":i.gas_limit=""+e.gas_limit,void 0===e.storage_limit?i.storage_limit="0":i.storage_limit=""+e.storage_limit,void 0!==e.balance&&(i.balance=""+i.balance),void 0!==e.amount&&(i.amount=""+i.amount),i.counter=r?""+ ++n:""+ ++this._counters[u]),this._conformOperation(i,t.next_protocol)})})(c);let l="";if(this._localForge&&!this._validateLocalForge||(l=yield this.query(`/chains/${this.chain}/blocks/${o.hash}/helpers/forge/operations`,i)),i.protocol=t.next_protocol,!this._localForge)return{opbytes:l,opOb:i,counter:n,chainId:o.chain_id};const p=yield qe(i,n,t.next_protocol);if(this._validateLocalForge){if(p.opbytes===l)return Object.assign(Object.assign({},p),{counter:n,chainId:o.chain_id});throw new Error("Forge validation error - local and remote bytes don't match")}return Object.assign(Object.assign({},p),{counter:n,chainId:o.chain_id})})))},this.simulateOperation=({operation:e,source:t})=>this.prepareOperation({operation:e,source:t,skipCounter:!0}).then(e=>(delete e.opOb.protocol,e.opOb.signature="edsigtXomBKi5CTRf5cjATJWSyaRvhfYNHqSUGrn4SdbYRcGwQrUGjzEfQDTuqHhuA8b2d8NarZjz8TRf65WkpQmo423BtomS8Q",this.query(`/chains/${this.chain}/blocks/head/helpers/scripts/run_operation`,{chain_id:e.chainId,operation:e.opOb}))),this.sendOperation=({operation:e,source:t,skipPrevalidation:r=!1,skipSignature:n=!1})=>Re(this,void 0,void 0,(function*(){const i=yield this.prepareOperation({operation:e,source:t});if(n)i.opbytes+="00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",i.opOb.signature="edsigtXomBKi5CTRf5cjATJWSyaRvhfYNHqSUGrn4SdbYRcGwQrUGjzEfQDTuqHhuA8b2d8NarZjz8TRf65WkpQmo423BtomS8Q";else{const e=yield this.key.sign(i.opbytes,x.generic);i.opbytes=e.sbytes,i.opOb.signature=e.prefixSig}const s=t||this.key.publicKeyHash();return r?this.silentInject(i.opbytes).catch(e=>{throw this._counters[s]=i.counter,e}):this.inject(i.opOb,i.opbytes).catch(e=>{throw this._counters[s]=i.counter,e})})),this.inject=(e,t)=>{const r=[];let n=[];return this.query(`/chains/${this.chain}/blocks/head/helpers/preapply/operations`,[e]).then(e=>{if(!Array.isArray(e))throw new Error("RPC Fail");for(let t=0;t<e.length;t++)for(let i=0;i<e[t].contents.length;i++)r.push(e[t].contents[i]),void 0!==e[t].contents[i].metadata.operation_result&&"failed"===e[t].contents[i].metadata.operation_result.status&&(n=n.concat(e[t].contents[i].metadata.operation_result.errors));if(n.length)throw new Error(JSON.stringify({error:"Operation Failed",errors:n},null,2));return this.query("/injection/operation",t)}).then(e=>({hash:e,operations:r}))},this.silentInject=e=>this.query("/injection/operation",e).then(e=>({hash:e})),this.transfer=({to:e,amount:t,source:r,fee:n=this.defaultFee,parameters:i,gasLimit:s=10600,storageLimit:o=300})=>{const a={kind:"transaction",fee:n,gas_limit:s,storage_limit:o,amount:this.useMutez?t:D(t),destination:e};return i&&(a.parameters="string"==typeof i?Z(i):i),this.sendOperation({operation:[a],source:r})},this.activate=(e,t)=>{const r={kind:"activate_account",pkh:e,secret:t};return this.sendOperation({operation:[r],source:e,skipSignature:!0})},this.originate=({balance:e,code:t,init:r,spendable:n=!1,delegatable:i=!1,delegate:s,fee:o=this.defaultFee,gasLimit:a=10600,storageLimit:c=257})=>Re(this,void 0,void 0,(function*(){let u,h;u="string"==typeof t?te(t):t,h="string"==typeof r?Z(r):r;const l={code:u,storage:h},p=this.key.publicKeyHash(),d={kind:"origination",fee:o,gas_limit:a,storage_limit:c,balance:this.useMutez?e:D(e),manager_pubkey:p,spendable:n,delegatable:i,script:l};return s&&(d.delegate=s),this.sendOperation({operation:[d]})})),this.setDelegate=({delegate:e,source:t=this.key.publicKeyHash(),fee:r=this.defaultFee,gasLimit:n=10600,storageLimit:i=0})=>Re(this,void 0,void 0,(function*(){const s={kind:"delegation",source:t,fee:r,gas_limit:n,storage_limit:i,delegate:e};return this.sendOperation({operation:[s],source:t})})),this.registerDelegate=({fee:e=this.defaultFee,gasLimit:t=10600,storageLimit:r=0}={})=>Re(this,void 0,void 0,(function*(){const n={kind:"delegation",fee:e,gas_limit:t,storage_limit:r,delegate:this.key.publicKeyHash()};return this.sendOperation({operation:[n]})})),this.typecheckCode=(e,t=1e4)=>{let r=e;return"string"==typeof e&&(r=te(e)),this.query(`/chains/${this.chain}/blocks/head/helpers/scripts/typecheck_code`,{program:r,gas:t})},this.packData=(e,t)=>{let r=e,n=t;"string"==typeof e&&(r=Z(e)),"string"==typeof t&&(n=Z(t));const i={data:r,type:n,gas:"4000000"};return this.query(`/chains/${this.chain}/blocks/head/helpers/scripts/pack_data`,i)},this.typecheckData=(e,t)=>{let r=e,n=t;"string"==typeof e&&(r=Z(e)),"string"==typeof t&&(n=Z(t));const i={data:r,type:n,gas:"4000000"};return this.query(`/chains/${this.chain}/blocks/head/helpers/scripts/typecheck_data`,i)},this.runCode=(e,t,r,n,i=!1)=>{const s=i?"trace_code":"run_code";let o=e,a=r,c=n;return"string"==typeof e&&(o=Z(e)),"string"==typeof r&&(a=Z(r)),"string"==typeof n&&(c=Z(n)),this.query(`/chains/${this.chain}/blocks/head/helpers/scripts/${s}`,{script:o,amount:this.useMutez?""+t:""+D(t),input:a,storage:c})},this.getManagerKey=(e,t)=>{if(!e)return null;const r={[""+M["001"]]:e.key,[""+M["002"]]:e.key,[""+M["003"]]:e.key,[""+M["004"]]:e.key,[""+M["005a"]]:e,[""+M["005"]]:e,[""+M["006"]]:e};if(!r[t])throw new Error("Unrecognized protocol: "+t);return r[t]},this._conformOperation=(e,t)=>{const r=e=>e,n=e=>(delete e.manager_pubkey,delete e.spendable,delete e.delegatable,e);return{[""+M["001"]]:r,[""+M["002"]]:r,[""+M["003"]]:r,[""+M["004"]]:r,[""+M["005a"]]:n,[""+M["005"]]:n,[""+M["006"]]:n}[t](e)},this.loadContract=e=>Re(this,void 0,void 0,(function*(){const t=new fe(this,e);return yield t.loaded,t})),this._defaultFee=r.defaultFee||1420,this._localForge=!1!==r.localForge,this._validateLocalForge=r.validateLocalForge||!1,this._debugMode=r.debugMode||!1,this._useMutez=!1!==r.useMutez,this._counters={}}get defaultFee(){return this._defaultFee}set defaultFee(e){this._defaultFee=e}get localForge(){return this._localForge}set localForge(e){this._localForge=e}get validateLocalForge(){return this._validateLocalForge}set validateLocalForge(e){this._validateLocalForge=e}get counters(){return this._counters}set counters(e){this._counters=e}get debugMode(){return this._debugMode}set debugMode(e){this._debugMode=e}get useMutez(){return this._useMutez}set useMutez(e){this._useMutez=e}setProvider(e,t=this.chain){super.setProvider(e,t),this.provider=e,this.chain=t}}var De=r(10),Ye=function(e,t,r,n){return new(r||(r=Promise))((function(i,s){function o(e){try{c(n.next(e))}catch(e){s(e)}}function a(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,a)}c((n=n.apply(e,t||[])).next())}))};const Ge=(e,t="")=>Ye(void 0,void 0,void 0,(function*(){try{yield s.ready}catch(e){throw new Error(e)}const r=s,n=e.substring(0,2);if(![54,55,88,98].includes(e.length))throw new Error("Invalid length for a key encoding");const i="e"===e.substring(2,3);if("ed"===n){if(i){const n=u()(G(e,S.edesk)),i=n.slice(0,8),s=n.slice(8);if(!t)throw new Error("No password was provided to decrypt the key");const a=o.pbkdf2Sync(t,i,32768,32,"sha512"),c=r.crypto_sign_seed_keypair(r.crypto_secretbox_open_easy(s,new Uint8Array(24),a));return{sk:Y(c.privateKey,S.edsk),pk:Y(c.publicKey,S.edpk),pkh:Y(r.crypto_generichash(20,c.publicKey),S.tz1)}}if(98===e.length)return{sk:e,pk:Y(G(e,S.edsk).slice(32),S.edpk),pkh:Y(r.crypto_generichash(20,G(e,S.edsk).slice(32)),S.tz1)};if(54===e.length){const t=G(e,S.edsk2),n=r.crypto_sign_seed_keypair(t);return{sk:Y(n.privateKey,S.edsk),pk:Y(n.publicKey,S.edpk),pkh:Y(r.crypto_generichash(20,n.publicKey),S.tz1)}}}return console.error("Invalid prefix for a key encoding"),{sk:"",pk:"",pkh:""}})),Qe=()=>Object(De.generateMnemonic)(256),Je=e=>{try{return G(e,S.tz1),!0}catch(e){return!1}},Ve=(e,t)=>Ye(void 0,void 0,void 0,(function*(){try{yield s.ready}catch(e){throw new Error(e)}const r=s,n=yield Object(De.mnemonicToSeed)(e,t).then(e=>e.slice(0,32)),i=r.crypto_sign_seed_keypair(u()(n));return{mnemonic:e,passphrase:t,sk:Y(i.privateKey,S.edsk),pk:Y(i.publicKey,S.edpk),pkh:Y(r.crypto_generichash(20,i.publicKey),S.tz1)}})),Xe=(e,t,r,n="")=>Ye(void 0,void 0,void 0,(function*(){try{yield s.ready}catch(e){throw new Error(e)}const i=s;if(54===t.length||55===t.length)try{({sk:t}=yield Ge(t,n))}catch(e){throw new Error(e)}let o=J(e);void 0!==r&&(o=X(r,o));const a=i.crypto_sign_detached(i.crypto_generichash(32,o),G(t,S.edsk),"uint8array"),c=Y(a,S.edsig),h=u()(a),l=e+Q(h);return{bytes:e,magicBytes:r?Q(u()(r)):"",sig:Y(a,S.sig),prefixSig:c,sbytes:l}})),We=(e,t,r)=>Ye(void 0,void 0,void 0,(function*(){try{yield s.ready}catch(e){throw new Error(e)}const n=s,i=u()(J(e)),o=G(t,S.sig);return n.crypto_sign_verify_detached(o,n.crypto_generichash(32,i),G(r,S.edpk))}));var Ze={extractKeys:Ge,generateKeys:Ve,checkAddress:Je,generateMnemonic:Qe,sign:Xe,verify:We}}])}));